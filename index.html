<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chinese Character Learning</title>
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap');
        
        body {
            font-family: 'Noto Sans SC', sans-serif;
        }
        
        .card {
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        
        .card.flipped {
            transform: rotateY(180deg);
        }
        
        .card-front, .card-back {
            backface-visibility: hidden;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .card-back {
            transform: rotateY(180deg);
        }
        
        .progress-bar {
            transition: width 0.5s ease-in-out;
        }
        
        .word-card {
            transition: all 0.3s ease;
        }
        
        .word-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        
        .game-tile {
            transition: all 0.3s ease;
        }
        
        .game-tile:hover {
            transform: scale(1.05);
        }
        
        .pulse-success {
            animation: pulseSuccess 0.5s;
        }
        
        @keyframes pulseSuccess {
            0% { box-shadow: 0 0 0 0 rgba(72, 187, 120, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(72, 187, 120, 0); }
            100% { box-shadow: 0 0 0 0 rgba(72, 187, 120, 0); }
        }
    </style>
</head>
<body class="bg-green-50 min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Word data structure
        const wordData = {
            'L1-2': [
                { chinese: 'ä¸€ä¸ª', english: 'one/a', russian: 'Ð¾Ð´Ð¸Ð½/Ð¾Ð´Ð½Ð°' },
                { chinese: 'ä¸€å¤©', english: 'one day', russian: 'Ð¾Ð´Ð¸Ð½ Ð´ÐµÐ½ÑŒ' },
                { chinese: 'äºŒå', english: 'twenty', russian: 'Ð´Ð²Ð°Ð´Ñ†Ð°Ñ‚ÑŒ' },
                { chinese: 'åäºŒ', english: 'twelve', russian: 'Ð´Ð²ÐµÐ½Ð°Ð´Ñ†Ð°Ñ‚ÑŒ' },
                { chinese: 'ä¸‰å', english: 'thirty', russian: 'Ñ‚Ñ€Ð¸Ð´Ñ†Ð°Ñ‚ÑŒ' },
                { chinese: 'åä¸‰', english: 'thirteen', russian: 'Ñ‚Ñ€Ð¸Ð½Ð°Ð´Ñ†Ð°Ñ‚ÑŒ' },
                { chinese: 'åä¸€', english: 'eleven', russian: 'Ð¾Ð´Ð¸Ð½Ð½Ð°Ð´Ñ†Ð°Ñ‚ÑŒ' },
                { chinese: 'ä¸‰åäºŒ', english: 'thirty-two', russian: 'Ñ‚Ñ€Ð¸Ð´Ñ†Ð°Ñ‚ÑŒ Ð´Ð²Ð°' },
                { chinese: 'ä¸Šåˆ', english: 'morning', russian: 'ÑƒÑ‚Ñ€Ð¾' },
                { chinese: 'ä¸Šè¯¾', english: 'attend class', russian: 'Ð¿Ð¾ÑÐµÑ‰Ð°Ñ‚ÑŒ Ð·Ð°Ð½ÑÑ‚Ð¸Ñ' },
                { chinese: 'ä¸€åƒ', english: 'one thousand', russian: 'Ð¾Ð´Ð½Ð° Ñ‚Ñ‹ÑÑÑ‡Ð°' },
                { chinese: 'ä¸‰åƒ', english: 'three thousand', russian: 'Ñ‚Ñ€Ð¸ Ñ‚Ñ‹ÑÑÑ‡Ð¸' },
                { chinese: 'ä¸‹åˆ', english: 'afternoon', russian: 'Ð¿Ð¾ÑÐ»Ðµ Ð¿Ð¾Ð»ÑƒÐ´Ð½Ñ' },
                { chinese: 'å­¦ç”Ÿ', english: 'student', russian: 'ÑÑ‚ÑƒÐ´ÐµÐ½Ñ‚' },
                { chinese: 'ä¸€ä¸ªå­¦ç”Ÿ', english: 'one student', russian: 'Ð¾Ð´Ð¸Ð½ ÑÑ‚ÑƒÐ´ÐµÐ½Ñ‚' },
                { chinese: 'åå…«', english: 'eighteen', russian: 'Ð²Ð¾ÑÐµÐ¼Ð½Ð°Ð´Ñ†Ð°Ñ‚ÑŒ' },
                { chinese: 'å…«å', english: 'eighty', russian: 'Ð²Ð¾ÑÐµÐ¼ÑŒÐ´ÐµÑÑÑ‚' },
                { chinese: 'ä¸€ä¸ªäºº', english: 'one person', russian: 'Ð¾Ð´Ð¸Ð½ Ñ‡ÐµÐ»Ð¾Ð²ÐµÐº' },
                { chinese: 'ä¸­å›½äºº', english: 'Chinese person', russian: 'ÐºÐ¸Ñ‚Ð°ÐµÑ†' },
                { chinese: 'å…«ä¸ªå­¦ç”Ÿ', english: 'eight students', russian: 'Ð²Ð¾ÑÐµÐ¼ÑŒ ÑÑ‚ÑƒÐ´ÐµÐ½Ñ‚Ð¾Ð²' },
                { chinese: 'ä¸‰ä¸ªä¸­å›½äºº', english: 'three Chinese people', russian: 'Ñ‚Ñ€Ð¸ ÐºÐ¸Ñ‚Ð°Ð¹Ñ†Ð°' },
                { chinese: 'ä»Šå¤©', english: 'today', russian: 'ÑÐµÐ³Ð¾Ð´Ð½Ñ' },
                { chinese: 'æ˜Žå¤©', english: 'tomorrow', russian: 'Ð·Ð°Ð²Ñ‚Ñ€Ð°' },
                { chinese: 'ä¸‹è¯¾', english: 'finish class', russian: 'Ð·Ð°ÐºÐ¾Ð½Ñ‡Ð¸Ñ‚ÑŒ Ð·Ð°Ð½ÑÑ‚Ð¸Ñ' },
                { chinese: 'å…­å', english: 'sixty', russian: 'ÑˆÐµÑÑ‚ÑŒÐ´ÐµÑÑÑ‚' },
                { chinese: 'å…­åƒ', english: 'six thousand', russian: 'ÑˆÐµÑÑ‚ÑŒ Ñ‚Ñ‹ÑÑÑ‡' },
                { chinese: 'å­¦ä¹ ', english: 'study', russian: 'ÑƒÑ‡Ð¸Ñ‚ÑŒÑÑ' }
            ],
            'L1': [
                { chinese: 'å·¥äºº', english: 'worker', russian: 'Ñ€Ð°Ð±Ð¾Ñ‡Ð¸Ð¹' },
                { chinese: 'å·¥ä½œ', english: 'work', russian: 'Ñ€Ð°Ð±Ð¾Ñ‚Ð°' },
                { chinese: 'å¹²ä»€ä¹ˆ', english: 'what to do', russian: 'Ñ‡Ñ‚Ð¾ Ð´ÐµÐ»Ð°Ñ‚ÑŒ' },
                { chinese: 'åœŸè±†', english: 'potato', russian: 'ÐºÐ°Ñ€Ñ‚Ð¾Ñ„ÐµÐ»ÑŒ' },
                { chinese: 'çŽ‹è€å¸ˆ', english: 'Teacher Wang', russian: 'Ð£Ñ‡Ð¸Ñ‚ÐµÐ»ÑŒ Ð’Ð°Ð½' },
                { chinese: 'æˆ‘å§“çŽ‹', english: 'My surname is Wang', russian: 'ÐœÐ¾Ñ Ñ„Ð°Ð¼Ð¸Ð»Ð¸Ñ Ð’Ð°Ð½' },
                { chinese: 'ç‰›å¥¶', english: 'milk', russian: 'Ð¼Ð¾Ð»Ð¾ÐºÐ¾' },
                { chinese: 'ç‰›è‚‰', english: 'beef', russian: 'Ð³Ð¾Ð²ÑÐ´Ð¸Ð½Ð°' },
                { chinese: 'å·¥åŽ‚', english: 'factory', russian: 'Ñ„Ð°Ð±Ñ€Ð¸ÐºÐ°' },
                { chinese: 'å¹¿å‘Š', english: 'advertisement', russian: 'Ñ€ÐµÐºÐ»Ð°Ð¼Ð°' },
                { chinese: 'å¤§å­¦', english: 'university', russian: 'ÑƒÐ½Ð¸Ð²ÐµÑ€ÑÐ¸Ñ‚ÐµÑ‚' },
                { chinese: 'å¤ªå¥½äº†', english: 'great', russian: 'Ð¾Ñ‚Ð»Ð¸Ñ‡Ð½Ð¾' },
                { chinese: 'å¼€é—¨', english: 'open the door', russian: 'Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ð´Ð²ÐµÑ€ÑŒ' },
                { chinese: 'å¼€å§‹', english: 'start', russian: 'Ð½Ð°Ñ‡Ð°Ñ‚ÑŒ' },
                { chinese: 'å…³é—¨', english: 'close the door', russian: 'Ð·Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ Ð´Ð²ÐµÑ€ÑŒ' },
                { chinese: 'æœ¨é—¨', english: 'wooden door', russian: 'Ð´ÐµÑ€ÐµÐ²ÑÐ½Ð½Ð°Ñ Ð´Ð²ÐµÑ€ÑŒ' },
                { chinese: 'æœ¬å­', english: 'notebook', russian: 'Ñ‚ÐµÑ‚Ñ€Ð°Ð´ÑŒ' },
                { chinese: 'ä¸€æœ¬ä¹¦', english: 'a book', russian: 'Ð¾Ð´Ð½Ð° ÐºÐ½Ð¸Ð³Ð°' },
                { chinese: 'ä¸æ˜¯', english: 'is not', russian: 'Ð½Ðµ ÑÐ²Ð»ÑÐµÑ‚ÑÑ' },
                { chinese: 'ä¸å¥½', english: 'not good', russian: 'Ð½Ðµ Ñ…Ð¾Ñ€Ð¾ÑˆÐ¾' },
                { chinese: 'ä¸­æ–‡', english: 'Chinese language', russian: 'ÐºÐ¸Ñ‚Ð°Ð¹ÑÐºÐ¸Ð¹ ÑÐ·Ñ‹Ðº' },
                { chinese: 'è‹±æ–‡', english: 'English language', russian: 'Ð°Ð½Ð³Ð»Ð¸Ð¹ÑÐºÐ¸Ð¹ ÑÐ·Ñ‹Ðº' },
                { chinese: 'å¤šå°‘', english: 'how much/many', russian: 'ÑÐºÐ¾Ð»ÑŒÐºÐ¾' },
                { chinese: 'å¾ˆå°‘', english: 'very few', russian: 'Ð¾Ñ‡ÐµÐ½ÑŒ Ð¼Ð°Ð»Ð¾' },
                { chinese: 'æ¥ä¸­å›½', english: 'come to China', russian: 'Ð¿Ñ€Ð¸ÐµÑ…Ð°Ñ‚ÑŒ Ð² ÐšÐ¸Ñ‚Ð°Ð¹' },
                { chinese: 'æ¥åŒ—äº¬', english: 'come to Beijing', russian: 'Ð¿Ñ€Ð¸ÐµÑ…Ð°Ñ‚ÑŒ Ð² ÐŸÐµÐºÐ¸Ð½' },
                { chinese: 'èµ°è·¯', english: 'walk', russian: 'Ñ…Ð¾Ð´Ð¸Ñ‚ÑŒ Ð¿ÐµÑˆÐºÐ¾Ð¼' },
                { chinese: 'ä½œä¸š', english: 'homework', russian: 'Ð´Ð¾Ð¼Ð°ÑˆÐ½ÐµÐµ Ð·Ð°Ð´Ð°Ð½Ð¸Ðµ' },
                { chinese: 'ç«è½¦', english: 'train', russian: 'Ð¿Ð¾ÐµÐ·Ð´' },
                { chinese: 'ä¸€æ–¤', english: 'one jin (500g)', russian: 'Ð¾Ð´Ð¸Ð½ Ñ†Ð·Ð¸Ð½ÑŒ (500Ð³)' },
                { chinese: 'å…«æ–¤', english: 'eight jin', russian: 'Ð²Ð¾ÑÐµÐ¼ÑŒ Ñ†Ð·Ð¸Ð½ÐµÐ¹' },
                { chinese: 'ä»Šå¹´', english: 'this year', russian: 'Ð² ÑÑ‚Ð¾Ð¼ Ð³Ð¾Ð´Ñƒ' },
                { chinese: 'æ˜Žå¹´', english: 'next year', russian: 'Ð² ÑÐ»ÐµÐ´ÑƒÑŽÑ‰ÐµÐ¼ Ð³Ð¾Ð´Ñƒ' },
                { chinese: 'å¤´å‘', english: 'hair', russian: 'Ð²Ð¾Ð»Ð¾ÑÑ‹' },
                { chinese: 'ç”µè¯å¡', english: 'phone card', russian: 'Ñ‚ÐµÐ»ÐµÑ„Ð¾Ð½Ð½Ð°Ñ ÐºÐ°Ñ€Ñ‚Ð°' },
                { chinese: 'ä¸€å¼ å¡', english: 'one card', russian: 'Ð¾Ð´Ð½Ð° ÐºÐ°Ñ€Ñ‚Ð°' },
                { chinese: 'ä¸€å…±', english: 'altogether', russian: 'Ð²ÑÐµÐ³Ð¾' }
            ],
            'L2': [
                // For demo purposes, we'll use a subset of L1 as L2
                { chinese: 'å·¥äºº', english: 'worker', russian: 'Ñ€Ð°Ð±Ð¾Ñ‡Ð¸Ð¹' },
                { chinese: 'å·¥ä½œ', english: 'work', russian: 'Ñ€Ð°Ð±Ð¾Ñ‚Ð°' },
                { chinese: 'å¹²ä»€ä¹ˆ', english: 'what to do', russian: 'Ñ‡Ñ‚Ð¾ Ð´ÐµÐ»Ð°Ñ‚ÑŒ' },
                { chinese: 'åœŸè±†', english: 'potato', russian: 'ÐºÐ°Ñ€Ñ‚Ð¾Ñ„ÐµÐ»ÑŒ' },
                { chinese: 'çŽ‹è€å¸ˆ', english: 'Teacher Wang', russian: 'Ð£Ñ‡Ð¸Ñ‚ÐµÐ»ÑŒ Ð’Ð°Ð½' },
                { chinese: 'æˆ‘å§“çŽ‹', english: 'My surname is Wang', russian: 'ÐœÐ¾Ñ Ñ„Ð°Ð¼Ð¸Ð»Ð¸Ñ Ð’Ð°Ð½' },
                { chinese: 'ç‰›å¥¶', english: 'milk', russian: 'Ð¼Ð¾Ð»Ð¾ÐºÐ¾' },
                { chinese: 'ç‰›è‚‰', english: 'beef', russian: 'Ð³Ð¾Ð²ÑÐ´Ð¸Ð½Ð°' },
                { chinese: 'å·¥åŽ‚', english: 'factory', russian: 'Ñ„Ð°Ð±Ñ€Ð¸ÐºÐ°' },
                { chinese: 'å¹¿å‘Š', english: 'advertisement', russian: 'Ñ€ÐµÐºÐ»Ð°Ð¼Ð°' }
            ]
        };

        // Speech synthesis function
        const speakText = (text, lang = 'zh-CN') => {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = lang;
                utterance.rate = 0.8;
                window.speechSynthesis.speak(utterance);
            }
        };

        // Main App Component
        function App() {
            const [mode, setMode] = useState('flashcard'); // flashcard, quiz, typeit, minigame, wordlist
            const [currentDeck, setCurrentDeck] = useState('L1-2');
            const [progress, setProgress] = useState({});
            
            // Load progress from localStorage on initial render
            useEffect(() => {
                const savedProgress = localStorage.getItem('chineseLearningProgress');
                if (savedProgress) {
                    setProgress(JSON.parse(savedProgress));
                }
            }, []);
            
            // Save progress to localStorage whenever it changes
            useEffect(() => {
                localStorage.setItem('chineseLearningProgress', JSON.stringify(progress));
            }, [progress]);
            
            // Update progress for a word
            const updateProgress = (word, mastery) => {
                setProgress(prev => ({
                    ...prev,
                    [word]: mastery
                }));
            };
            
            // Reset progress
            const resetProgress = () => {
                if (window.confirm('Are you sure you want to reset all progress?')) {
                    setProgress({});
                }
            };
            
            // Calculate stats
            const stats = {
                total: wordData[currentDeck].length,
                mastered: Object.values(progress).filter(level => level >= 4).length,
                learning: Object.values(progress).filter(level => level > 0 && level < 4).length,
                new: Object.values(progress).filter(level => level === 0 || !level).length
            };
            
            return (
                <div className="min-h-screen bg-gradient-to-br from-green-50 to-green-100">
                    {/* Header */}
                    <header className="bg-green-600 text-white p-4 shadow-md">
                        <div className="container mx-auto flex flex-col md:flex-row justify-between items-center">
                            <h1 className="text-2xl font-bold mb-2 md:mb-0">Chinese Character Learning</h1>
                            <div className="flex items-center space-x-4">
                                <DeckSelector 
                                    currentDeck={currentDeck} 
                                    setCurrentDeck={setCurrentDeck} 
                                />
                                <ProgressStats stats={stats} />
                            </div>
                        </div>
                    </header>
                    
                    {/* Navigation */}
                    <nav className="bg-white shadow-sm py-3">
                        <div className="container mx-auto flex flex-wrap justify-center">
                            <ModeButton 
                                mode="flashcard" 
                                currentMode={mode} 
                                setMode={setMode} 
                                label="Flashcards" 
                            />
                            <ModeButton 
                                mode="quiz" 
                                currentMode={mode} 
                                setMode={setMode} 
                                label="Quiz" 
                            />
                            <ModeButton 
                                mode="typeit" 
                                currentMode={mode} 
                                setMode={setMode} 
                                label="Type It" 
                            />
                            <ModeButton 
                                mode="minigame" 
                                currentMode={mode} 
                                setMode={setMode} 
                                label="Mini Game" 
                            />
                            <ModeButton 
                                mode="wordlist" 
                                currentMode={mode} 
                                setMode={setMode} 
                                label="Word List" 
                            />
                        </div>
                    </nav>
                    
                    {/* Main Content */}
                    <main className="container mx-auto p-4">
                        {mode === 'flashcard' && (
                            <FlashcardMode 
                                deck={wordData[currentDeck]} 
                                progress={progress} 
                                updateProgress={updateProgress} 
                            />
                        )}
                        
                        {mode === 'quiz' && (
                            <QuizMode 
                                deck={wordData[currentDeck]} 
                                progress={progress} 
                                updateProgress={updateProgress} 
                            />
                        )}
                        
                        {mode === 'typeit' && (
                            <TypeItMode 
                                deck={wordData[currentDeck]} 
                                progress={progress} 
                                updateProgress={updateProgress} 
                            />
                        )}
                        
                        {mode === 'minigame' && (
                            <MiniGameMode 
                                deck={wordData[currentDeck]} 
                                progress={progress} 
                                updateProgress={updateProgress} 
                            />
                        )}
                        
                        {mode === 'wordlist' && (
                            <WordListMode 
                                deck={wordData[currentDeck]} 
                                progress={progress} 
                            />
                        )}
                    </main>
                    
                    {/* Footer */}
                    <footer className="bg-green-800 text-white p-4 mt-8">
                        <div className="container mx-auto flex flex-col md:flex-row justify-between items-center">
                            <p>Chinese Learning App &copy; {new Date().getFullYear()}</p>
                            <button 
                                onClick={resetProgress}
                                className="mt-2 md:mt-0 px-4 py-2 bg-red-500 hover:bg-red-600 rounded-lg transition-colors"
                            >
                                Reset Progress
                            </button>
                        </div>
                    </footer>
                </div>
            );
        }

        // Deck Selector Component
        function DeckSelector({ currentDeck, setCurrentDeck }) {
            return (
                <div className="flex items-center">
                    <span className="mr-2">Deck:</span>
                    <select 
                        value={currentDeck} 
                        onChange={(e) => setCurrentDeck(e.target.value)}
                        className="bg-green-700 text-white px-2 py-1 rounded"
                    >
                        <option value="L1-2">L1-2</option>
                        <option value="L1">L1</option>
                        <option value="L2">L2</option>
                    </select>
                </div>
            );
        }

        // Progress Stats Component
        function ProgressStats({ stats }) {
            const percentage = Math.round((stats.mastered / stats.total) * 100);
            
            return (
                <div className="flex items-center">
                    <div className="mr-4 text-center">
                        <div className="text-lg font-bold">{stats.mastered}/{stats.total}</div>
                        <div className="text-xs">Mastered</div>
                    </div>
                    <div className="w-24 bg-green-200 rounded-full h-2.5">
                        <div 
                            className="bg-green-700 h-2.5 rounded-full progress-bar" 
                            style={{ width: `${percentage}%` }}
                        ></div>
                    </div>
                    <span className="ml-2 text-sm">{percentage}%</span>
                </div>
            );
        }

        // Mode Button Component
        function ModeButton({ mode, currentMode, setMode, label }) {
            const isActive = mode === currentMode;
            
            return (
                <button
                    onClick={() => setMode(mode)}
                    className={`mx-2 my-1 px-4 py-2 rounded-lg transition-colors ${
                        isActive 
                            ? 'bg-green-600 text-white' 
                            : 'bg-green-100 text-green-800 hover:bg-green-200'
                    }`}
                >
                    {label}
                </button>
            );
        }

        // Flashcard Mode Component
        function FlashcardMode({ deck, progress, updateProgress }) {
            const [currentIndex, setCurrentIndex] = useState(0);
            const [isFlipped, setIsFlipped] = useState(false);
            const cardRef = useRef(null);
            
            // Keyboard shortcuts
            useEffect(() => {
                const handleKeyDown = (e) => {
                    if (e.code === 'Space') {
                        e.preventDefault();
                        setIsFlipped(!isFlipped);
                    } else if (e.code === 'KeyK' && isFlipped) {
                        // Knew it
                        updateProgress(deck[currentIndex].chinese, Math.min(5, (progress[deck[currentIndex].chinese] || 0) + 1));
                        nextCard();
                    } else if (e.code === 'KeyA' && isFlipped) {
                        // Again
                        updateProgress(deck[currentIndex].chinese, Math.max(0, (progress[deck[currentIndex].chinese] || 0) - 1));
                        nextCard();
                    } else if (e.code === 'KeyV') {
                        // Voice
                        if (isFlipped) {
                            speakText(deck[currentIndex].english, 'en-US');
                        } else {
                            speakText(deck[currentIndex].chinese);
                        }
                    }
                };
                
                window.addEventListener('keydown', handleKeyDown);
                return () => window.removeEventListener('keydown', handleKeyDown);
            }, [currentIndex, isFlipped, deck, progress, updateProgress]);
            
            const nextCard = () => {
                setIsFlipped(false);
                setCurrentIndex((prevIndex) => (prevIndex + 1) % deck.length);
            };
            
            const prevCard = () => {
                setIsFlipped(false);
                setCurrentIndex((prevIndex) => (prevIndex - 1 + deck.length) % deck.length);
            };
            
            const masteryLevel = progress[deck[currentIndex]?.chinese] || 0;
            
            return (
                <div className="max-w-2xl mx-auto">
                    <div className="mb-4 flex justify-between items-center">
                        <button 
                            onClick={prevCard}
                            className="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors"
                        >
                            Previous
                        </button>
                        <div className="text-center">
                            <span className="font-bold">{currentIndex + 1}</span> / {deck.length}
                            <div className="flex justify-center mt-1">
                                {[1, 2, 3, 4, 5].map((level) => (
                                    <div 
                                        key={level}
                                        className={`w-4 h-4 mx-1 rounded-full ${
                                            level <= masteryLevel ? 'bg-green-500' : 'bg-gray-300'
                                        }`}
                                    ></div>
                                ))}
                            </div>
                        </div>
                        <button 
                            onClick={nextCard}
                            className="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors"
                        >
                            Next
                        </button>
                    </div>
                    
                    <div 
                        ref={cardRef}
                        className={`card relative w-full h-64 cursor-pointer ${isFlipped ? 'flipped' : ''}`}
                        onClick={() => setIsFlipped(!isFlipped)}
                    >
                        <div className="card-front bg-white rounded-xl shadow-lg flex flex-col justify-center items-center p-6">
                            <div className="text-4xl font-bold text-green-800 mb-4">
                                {deck[currentIndex]?.chinese}
                            </div>
                            <button 
                                onClick={(e) => {
                                    e.stopPropagation();
                                    speakText(deck[currentIndex].chinese);
                                }}
                                className="px-4 py-2 bg-green-100 text-green-800 rounded-lg hover:bg-green-200 transition-colors"
                            >
                                ðŸ”Š Speak
                            </button>
                            <div className="mt-4 text-sm text-gray-500">
                                Click or press Space to flip
                            </div>
                        </div>
                        
                        <div className="card-back bg-green-100 rounded-xl shadow-lg flex flex-col justify-center items-center p-6">
                            <div className="text-2xl font-bold text-green-800 mb-2">
                                {deck[currentIndex]?.english}
                            </div>
                            <div className="text-lg text-gray-700 mb-4">
                                {deck[currentIndex]?.russian}
                            </div>
                            <div className="flex space-x-2">
                                <button 
                                    onClick={(e) => {
                                        e.stopPropagation();
                                        speakText(deck[currentIndex].english, 'en-US');
                                    }}
                                    className="px-3 py-1 bg-white text-green-800 rounded-lg hover:bg-green-200 transition-colors"
                                >
                                    ðŸ”Š EN
                                </button>
                                <button 
                                    onClick={(e) => {
                                        e.stopPropagation();
                                        updateProgress(deck[currentIndex].chinese, Math.min(5, (progress[deck[currentIndex].chinese] || 0) + 1));
                                        nextCard();
                                    }}
                                    className="px-3 py-1 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors"
                                >
                                    Knew It (K)
                                </button>
                                <button 
                                    onClick={(e) => {
                                        e.stopPropagation();
                                        updateProgress(deck[currentIndex].chinese, Math.max(0, (progress[deck[currentIndex].chinese] || 0) - 1));
                                        nextCard();
                                    }}
                                    className="px-3 py-1 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 transition-colors"
                                >
                                    Again (A)
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div className="mt-6 text-center text-sm text-gray-600">
                        <p>Keyboard shortcuts: Space = Flip, K = Knew It, A = Again, V = Voice</p>
                    </div>
                </div>
            );
        }

        // Quiz Mode Component
        function QuizMode({ deck, progress, updateProgress }) {
            const [currentIndex, setCurrentIndex] = useState(0);
            const [options, setOptions] = useState([]);
            const [selectedOption, setSelectedOption] = useState(null);
            const [showResult, setShowResult] = useState(false);
            const [score, setScore] = useState(0);
            
            // Initialize quiz
            useEffect(() => {
                if (deck.length > 0) {
                    generateOptions(currentIndex);
                }
            }, [deck, currentIndex]);
            
            const generateOptions = (index) => {
                if (deck.length < 4) return;
                
                const correctAnswer = deck[index].chinese;
                const wrongAnswers = deck
                    .filter((_, i) => i !== index)
                    .sort(() => 0.5 - Math.random())
                    .slice(0, 3)
                    .map(item => item.chinese);
                
                const allOptions = [correctAnswer, ...wrongAnswers].sort(() => 0.5 - Math.random());
                setOptions(allOptions);
            };
            
            const handleAnswer = (option) => {
                if (showResult) return;
                
                setSelectedOption(option);
                setShowResult(true);
                
                const isCorrect = option === deck[currentIndex].chinese;
                if (isCorrect) {
                    setScore(score + 1);
                    updateProgress(deck[currentIndex].chinese, Math.min(5, (progress[deck[currentIndex].chinese] || 0) + 1));
                } else {
                    updateProgress(deck[currentIndex].chinese, Math.max(0, (progress[deck[currentIndex].chinese] || 0) - 1));
                }
                
                // Auto-advance after 1.5 seconds
                setTimeout(() => {
                    nextQuestion();
                }, 1500);
            };
            
            const nextQuestion = () => {
                setSelectedOption(null);
                setShowResult(false);
                setCurrentIndex((prevIndex) => (prevIndex + 1) % deck.length);
            };
            
            if (deck.length < 4) {
                return (
                    <div className="text-center p-8 bg-white rounded-xl shadow-lg">
                        <p className="text-lg">Not enough words in this deck for a quiz. Need at least 4 words.</p>
                    </div>
                );
            }
            
            return (
                <div className="max-w-2xl mx-auto">
                    <div className="mb-6 text-center">
                        <h2 className="text-2xl font-bold text-green-800 mb-2">Multiple Choice Quiz</h2>
                        <div className="flex justify-between items-center bg-white p-4 rounded-lg shadow">
                            <div>
                                Question: <span className="font-bold">{currentIndex + 1}</span> / {deck.length}
                            </div>
                            <div>
                                Score: <span className="font-bold">{score}</span> / {deck.length}
                            </div>
                        </div>
                    </div>
                    
                    <div className="bg-white rounded-xl shadow-lg p-6 mb-6">
                        <div className="text-center mb-6">
                            <div className="text-lg text-gray-700 mb-2">
                                What is the Chinese character for:
                            </div>
                            <div className="text-2xl font-bold text-green-800">
                                {deck[currentIndex]?.english}
                            </div>
                            <div className="text-lg text-gray-600 mt-1">
                                {deck[currentIndex]?.russian}
                            </div>
                        </div>
                        
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            {options.map((option, index) => {
                                const isCorrect = option === deck[currentIndex].chinese;
                                const isSelected = selectedOption === option;
                                let buttonClass = "p-4 text-lg rounded-lg transition-colors ";
                                
                                if (showResult) {
                                    if (isCorrect) {
                                        buttonClass += "bg-green-500 text-white pulse-success";
                                    } else if (isSelected) {
                                        buttonClass += "bg-red-500 text-white";
                                    } else {
                                        buttonClass += "bg-gray-200 text-gray-700";
                                    }
                                } else {
                                    buttonClass += "bg-green-100 text-green-800 hover:bg-green-200";
                                }
                                
                                return (
                                    <button
                                        key={index}
                                        className={buttonClass}
                                        onClick={() => handleAnswer(option)}
                                        disabled={showResult}
                                    >
                                        {option}
                                    </button>
                                );
                            })}
                        </div>
                    </div>
                    
                    {showResult && (
                        <div className="text-center">
                            <button 
                                onClick={nextQuestion}
                                className="px-6 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors"
                            >
                                Next Question
                            </button>
                        </div>
                    )}
                </div>
            );
        }

        // Type It Mode Component
        function TypeItMode({ deck, progress, updateProgress }) {
            const [currentIndex, setCurrentIndex] = useState(0);
            const [userInput, setUserInput] = useState('');
            const [showResult, setShowResult] = useState(false);
            const [isCorrect, setIsCorrect] = useState(false);
            const inputRef = useRef(null);
            
            useEffect(() => {
                if (inputRef.current) {
                    inputRef.current.focus();
                }
            }, [currentIndex]);
            
            const checkAnswer = () => {
                if (userInput.trim() === '') return;
                
                const correct = userInput.trim() === deck[currentIndex].chinese;
                setIsCorrect(correct);
                setShowResult(true);
                
                if (correct) {
                    updateProgress(deck[currentIndex].chinese, Math.min(5, (progress[deck[currentIndex].chinese] || 0) + 1));
                } else {
                    updateProgress(deck[currentIndex].chinese, Math.max(0, (progress[deck[currentIndex].chinese] || 0) - 1));
                }
            };
            
            const nextWord = () => {
                setUserInput('');
                setShowResult(false);
                setCurrentIndex((prevIndex) => (prevIndex + 1) % deck.length);
            };
            
            const handleKeyPress = (e) => {
                if (e.key === 'Enter') {
                    if (showResult) {
                        nextWord();
                    } else {
                        checkAnswer();
                    }
                }
            };
            
            return (
                <div className="max-w-2xl mx-auto">
                    <div className="mb-6 text-center">
                        <h2 className="text-2xl font-bold text-green-800 mb-2">Type the Chinese Characters</h2>
                        <div className="bg-white p-4 rounded-lg shadow inline-block">
                            Question: <span className="font-bold">{currentIndex + 1}</span> / {deck.length}
                        </div>
                    </div>
                    
                    <div className="bg-white rounded-xl shadow-lg p-6 mb-6">
                        <div className="text-center mb-6">
                            <div className="text-lg text-gray-700 mb-2">
                                Type the Chinese characters for:
                            </div>
                            <div className="text-2xl font-bold text-green-800">
                                {deck[currentIndex]?.english}
                            </div>
                            <div className="text-lg text-gray-600 mt-1">
                                {deck[currentIndex]?.russian}
                            </div>
                        </div>
                        
                        <div className="flex flex-col items-center">
                            <input
                                ref={inputRef}
                                type="text"
                                value={userInput}
                                onChange={(e) => setUserInput(e.target.value)}
                                onKeyPress={handleKeyPress}
                                className="w-full max-w-md p-4 text-xl border-2 border-green-300 rounded-lg focus:outline-none focus:border-green-500 text-center"
                                placeholder="Type here..."
                                disabled={showResult}
                            />
                            
                            {showResult && (
                                <div className={`mt-4 p-4 rounded-lg ${isCorrect ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`}>
                                    {isCorrect ? (
                                        <div className="text-center">
                                            <div className="text-2xl font-bold">Correct!</div>
                                            <div className="text-lg mt-2">{deck[currentIndex]?.chinese}</div>
                                        </div>
                                    ) : (
                                        <div className="text-center">
                                            <div className="text-xl font-bold">Incorrect</div>
                                            <div className="mt-2">
                                                The correct answer is: <span className="font-bold text-lg">{deck[currentIndex]?.chinese}</span>
                                            </div>
                                            <div className="mt-2">Your answer: {userInput}</div>
                                        </div>
                                    )}
                                </div>
                            )}
                        </div>
                    </div>
                    
                    <div className="text-center">
                        {!showResult ? (
                            <button 
                                onClick={checkAnswer}
                                className="px-6 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors"
                            >
                                Check Answer
                            </button>
                        ) : (
                            <button 
                                onClick={nextWord}
                                className="px-6 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors"
                            >
                                Next Word
                            </button>
                        )}
                    </div>
                    
                    <div className="mt-6 text-center text-sm text-gray-600">
                        <p>Press Enter to check your answer or move to the next word</p>
                    </div>
                </div>
            );
        }

        // Mini Game Mode Component
        function MiniGameMode({ deck, progress, updateProgress }) {
            const [gameState, setGameState] = useState('setup'); // setup, playing, result
            const [pairs, setPairs] = useState([]);
            const [selectedTile, setSelectedTile] = useState(null);
            const [matchedPairs, setMatchedPairs] = useState([]);
            const [moves, setMoves] = useState(0);
            
            // Initialize game
            useEffect(() => {
                if (gameState === 'setup' && deck.length >= 4) {
                    startGame();
                }
            }, [deck, gameState]);
            
            const startGame = () => {
                // Select 8 random words (4 pairs)
                const selectedWords = [...deck]
                    .sort(() => 0.5 - Math.random())
                    .slice(0, 4);
                
                // Create pairs: Chinese and English
                const newPairs = [];
                selectedWords.forEach(word => {
                    newPairs.push(
                        { id: `${word.chinese}-ch`, content: word.chinese, type: 'chinese', pairId: word.chinese },
                        { id: `${word.chinese}-en`, content: word.english, type: 'english', pairId: word.chinese }
                    );
                });
                
                // Shuffle the pairs
                setPairs(newPairs.sort(() => 0.5 - Math.random()));
                setMatchedPairs([]);
                setMoves(0);
                setGameState('playing');
            };
            
            const handleTileClick = (tile) => {
                if (selectedTile === tile || matchedPairs.includes(tile.pairId)) {
                    return;
                }
                
                if (!selectedTile) {
                    setSelectedTile(tile);
                    return;
                }
                
                setMoves(moves + 1);
                
                // Check if tiles match
                if (selectedTile.pairId === tile.pairId) {
                    // Match found
                    setMatchedPairs([...matchedPairs, tile.pairId]);
                    setSelectedTile(null);
                    
                    // Update progress for matched word
                    updateProgress(tile.pairId, Math.min(5, (progress[tile.pairId] || 0) + 1));
                    
                    // Speak the word
                    speakText(tile.pairId);
                    
                    // Check if game is complete
                    if (matchedPairs.length + 1 === 4) {
                        setTimeout(() => {
                            setGameState('result');
                        }, 1000);
                    }
                } else {
                    // No match
                    setTimeout(() => {
                        setSelectedTile(null);
                    }, 1000);
                }
            };
            
            if (deck.length < 4) {
                return (
                    <div className="text-center p-8 bg-white rounded-xl shadow-lg">
                        <p className="text-lg">Not enough words in this deck for the game. Need at least 4 words.</p>
                    </div>
                );
            }
            
            return (
                <div className="max-w-4xl mx-auto">
                    <div className="mb-6 text-center">
                        <h2 className="text-2xl font-bold text-green-800 mb-2">Matching Game</h2>
                        <p className="text-gray-700">Match Chinese characters with their English translations</p>
                        
                        {gameState === 'playing' && (
                            <div className="mt-4 bg-white p-4 rounded-lg shadow inline-block">
                                Moves: <span className="font-bold">{moves}</span> | 
                                Matched: <span className="font-bold">{matchedPairs.length}</span> / 4
                            </div>
                        )}
                    </div>
                    
                    {gameState === 'setup' && (
                        <div className="text-center">
                            <button 
                                onClick={startGame}
                                className="px-6 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors text-xl"
                            >
                                Start Game
                            </button>
                        </div>
                    )}
                    
                    {gameState === 'playing' && (
                        <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                            {pairs.map(tile => {
                                const isSelected = selectedTile?.id === tile.id;
                                const isMatched = matchedPairs.includes(tile.pairId);
                                
                                let tileClass = "game-tile p-4 rounded-lg shadow-lg flex items-center justify-center text-center min-h-24 cursor-pointer transition-all ";
                                
                                if (isMatched) {
                                    tileClass += "bg-green-500 text-white transform scale-95";
                                } else if (isSelected) {
                                    tileClass += tile.type === 'chinese' 
                                        ? "bg-blue-500 text-white" 
                                        : "bg-yellow-500 text-white";
                                } else {
                                    tileClass += "bg-white text-gray-800 hover:bg-gray-100";
                                }
                                
                                return (
                                    <div
                                        key={tile.id}
                                        className={tileClass}
                                        onClick={() => handleTileClick(tile)}
                                    >
                                        <div className="font-bold text-lg">
                                            {tile.content}
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    )}
                    
                    {gameState === 'result' && (
                        <div className="text-center bg-white rounded-xl shadow-lg p-8">
                            <div className="text-3xl font-bold text-green-800 mb-4">Game Complete!</div>
                            <div className="text-xl mb-6">
                                You matched all pairs in <span className="font-bold">{moves}</span> moves!
                            </div>
                            <button 
                                onClick={() => setGameState('setup')}
                                className="px-6 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors text-xl"
                            >
                                Play Again
                            </button>
                        </div>
                    )}
                </div>
            );
        }

        // Word List Mode Component
        function WordListMode({ deck, progress }) {
            const [filter, setFilter] = useState('all'); // all, mastered, learning, new
            
            const filteredDeck = deck.filter(word => {
                const mastery = progress[word.chinese] || 0;
                
                if (filter === 'all') return true;
                if (filter === 'mastered') return mastery >= 4;
                if (filter === 'learning') return mastery > 0 && mastery < 4;
                if (filter === 'new') return mastery === 0;
                
                return true;
            });
            
            return (
                <div className="max-w-6xl mx-auto">
                    <div className="mb-6 flex flex-col md:flex-row justify-between items-center">
                        <h2 className="text-2xl font-bold text-green-800 mb-4 md:mb-0">Word List</h2>
                        
                        <div className="flex space-x-2">
                            <FilterButton 
                                filter="all" 
                                currentFilter={filter} 
                                setFilter={setFilter} 
                                label="All Words" 
                            />
                            <FilterButton 
                                filter="new" 
                                currentFilter={filter} 
                                setFilter={setFilter} 
                                label="New" 
                            />
                            <FilterButton 
                                filter="learning" 
                                currentFilter={filter} 
                                setFilter={setFilter} 
                                label="Learning" 
                            />
                            <FilterButton 
                                filter="mastered" 
                                currentFilter={filter} 
                                setFilter={setFilter} 
                                label="Mastered" 
                            />
                        </div>
                    </div>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        {filteredDeck.map((word, index) => {
                            const mastery = progress[word.chinese] || 0;
                            
                            let bgColor = 'bg-white';
                            if (mastery >= 4) bgColor = 'bg-green-100';
                            else if (mastery > 0) bgColor = 'bg-yellow-100';
                            
                            return (
                                <div 
                                    key={index}
                                    className={`word-card ${bgColor} rounded-xl shadow p-4 flex flex-col`}
                                >
                                    <div className="flex justify-between items-start mb-2">
                                        <div 
                                            className="text-2xl font-bold text-green-800 cursor-pointer"
                                            onClick={() => speakText(word.chinese)}
                                        >
                                            {word.chinese}
                                        </div>
                                        <div className="flex">
                                            {[1, 2, 3, 4, 5].map(level => (
                                                <div 
                                                    key={level}
                                                    className={`w-3 h-3 mx-0.5 rounded-full ${
                                                        level <= mastery ? 'bg-green-500' : 'bg-gray-300'
                                                    }`}
                                                ></div>
                                            ))}
                                        </div>
                                    </div>
                                    
                                    <div className="text-lg text-gray-700 mb-1">
                                        {word.english}
                                    </div>
                                    
                                    <div className="text-gray-600">
                                        {word.russian}
                                    </div>
                                    
                                    <div className="mt-2 flex space-x-2">
                                        <button 
                                            onClick={() => speakText(word.chinese)}
                                            className="px-2 py-1 bg-green-200 text-green-800 rounded text-sm hover:bg-green-300 transition-colors"
                                        >
                                            ðŸ”Š CN
                                        </button>
                                        <button 
                                            onClick={() => speakText(word.english, 'en-US')}
                                            className="px-2 py-1 bg-blue-200 text-blue-800 rounded text-sm hover:bg-blue-300 transition-colors"
                                        >
                                            ðŸ”Š EN
                                        </button>
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                    
                    {filteredDeck.length === 0 && (
                        <div className="text-center p-8 bg-white rounded-xl shadow-lg">
                            <p className="text-lg">No words match the selected filter.</p>
                        </div>
                    )}
                </div>
            );
        }

        // Filter Button Component for Word List
        function FilterButton({ filter, currentFilter, setFilter, label }) {
            const isActive = filter === currentFilter;
            
            return (
                <button
                    onClick={() => setFilter(filter)}
                    className={`px-3 py-1 rounded-lg transition-colors ${
                        isActive 
                            ? 'bg-green-600 text-white' 
                            : 'bg-green-100 text-green-800 hover:bg-green-200'
                    }`}
                >
                    {label}
                </button>
            );
        }

        // Render the App
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
