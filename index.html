<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, maximum-scale=1"
  />
  <title>Experiencing Chinese Characters Â· L1 & L2 Trainer</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html, body { height: 100%; background:#f6fff8; }
    .btn { @apply px-3 py-2 rounded-xl shadow font-medium border; }
    .btn-primary { @apply bg-green-600 text-white hover:bg-green-700; }
    .btn-soft { @apply bg-white hover:bg-green-50; }
    .chip { @apply text-xs px-2 py-0.5 rounded-full border bg-white; }
    .kbd { @apply text-[10px] px-1.5 py-0.5 rounded border bg-white; }
    .card { @apply rounded-2xl shadow-lg bg-white; }
  </style>
</head>
<body class="text-gray-800">
  <div id="root"></div>

  <script type="text/babel">
/** =======================
 *  Utilities
 *  ======================= */
const speak = (text, lang='zh-CN') => {
  try {
    const u = new SpeechSynthesisUtterance(text);
    u.lang = lang;
    window.speechSynthesis.cancel();
    window.speechSynthesis.speak(u);
  } catch (e) { /* no-op */ }
};

const sample = (arr) => arr[Math.floor(Math.random() * arr.length)];
const shuffle = (arr) => [...arr].sort(() => Math.random() - 0.5);

/** =======================
 *  Data (L1 & L2 from screenshots)
 *  You can freely edit/extend this list.
 *  id must be unique; mastery saved by id.
 *  ======================= */
const L1 = [
  { id: "l1-ä¸€ä¸ª", zh: "ä¸€ä¸ª", en: "one; a/an", ru: "Ğ¾Ğ´Ğ¸Ğ½; Ğ¾Ğ´Ğ¸Ğ½ (Ğ¾Ğ´Ğ½Ğ¾/Ğ¾Ğ´Ğ½Ğ°)" },
  { id: "l1-ä¸€å¤©", zh: "ä¸€å¤©", en: "one day", ru: "Ğ¾Ğ´Ğ¸Ğ½ Ğ´ĞµĞ½ÑŒ" },
  { id: "l1-äºŒå", zh: "äºŒå", en: "twenty", ru: "Ğ´Ğ²Ğ°Ğ´Ñ†Ğ°Ñ‚ÑŒ" },
  { id: "l1-åäºŒ", zh: "åäºŒ", en: "twelve", ru: "Ğ´Ğ²ĞµĞ½Ğ°Ğ´Ñ†Ğ°Ñ‚ÑŒ" },
  { id: "l1-ä¸‰å", zh: "ä¸‰å", en: "thirty", ru: "Ñ‚Ñ€Ğ¸Ğ´Ñ†Ğ°Ñ‚ÑŒ" },
  { id: "l1-åä¸‰", zh: "åä¸‰", en: "thirteen", ru: "Ñ‚Ñ€Ğ¸Ğ½Ğ°Ğ´Ñ†Ğ°Ñ‚ÑŒ" },
  { id: "l1-åä¸€", zh: "åä¸€", en: "eleven", ru: "Ğ¾Ğ´Ğ¸Ğ½Ğ½Ğ°Ğ´Ñ†Ğ°Ñ‚ÑŒ" },
  { id: "l1-ä¸‰åäºŒ", zh: "ä¸‰åäºŒ", en: "thirty-two", ru: "Ñ‚Ñ€Ğ¸Ğ´Ñ†Ğ°Ñ‚ÑŒ Ğ´Ğ²Ğ°" },
  { id: "l1-ä¸Šåˆ", zh: "ä¸Šåˆ", en: "morning (a.m.)", ru: "ÑƒÑ‚Ñ€Ğ¾; Ğ´Ğ¾ Ğ¿Ğ¾Ğ»ÑƒĞ´Ğ½Ñ" },
  { id: "l1-ä¸Šè¯¾", zh: "ä¸Šè¯¾", en: "have class; start class", ru: "Ğ¸Ğ´Ñ‚Ğ¸ Ğ½Ğ° ÑƒÑ€Ğ¾Ğº; Ğ½Ğ°Ñ‡Ğ¸Ğ½Ğ°Ñ‚ÑŒ ÑƒÑ€Ğ¾Ğº" },
  { id: "l1-ä¸€åƒ", zh: "ä¸€åƒ", en: "one thousand", ru: "Ñ‚Ñ‹ÑÑÑ‡Ğ°" },
  { id: "l1-ä¸‰åƒ", zh: "ä¸‰åƒ", en: "three thousand", ru: "Ñ‚Ñ€Ğ¸ Ñ‚Ñ‹ÑÑÑ‡Ğ¸" },
  { id: "l1-ä¸‹åˆ", zh: "ä¸‹åˆ", en: "afternoon (p.m.)", ru: "Ğ´ĞµĞ½ÑŒ; Ğ¿Ğ¾ÑĞ»Ğµ Ğ¿Ğ¾Ğ»ÑƒĞ´Ğ½Ñ" },
  { id: "l1-å­¦ç”Ÿ", zh: "å­¦ç”Ÿ", en: "student", ru: "ÑÑ‚ÑƒĞ´ĞµĞ½Ñ‚; ÑƒÑ‡ĞµĞ½Ğ¸Ğº" },
  { id: "l1-ä¸€ä¸ªå­¦ç”Ÿ", zh: "ä¸€ä¸ªå­¦ç”Ÿ", en: "one student", ru: "Ğ¾Ğ´Ğ¸Ğ½ ÑÑ‚ÑƒĞ´ĞµĞ½Ñ‚/ÑƒÑ‡ĞµĞ½Ğ¸Ğº" },
  { id: "l1-åå…«", zh: "åå…«", en: "eighteen", ru: "Ğ²Ğ¾ÑĞµĞ¼Ğ½Ğ°Ğ´Ñ†Ğ°Ñ‚ÑŒ" },
  { id: "l1-å…«å", zh: "å…«å", en: "eighty", ru: "Ğ²Ğ¾ÑĞµĞ¼ÑŒĞ´ĞµÑÑÑ‚" },
  { id: "l1-ä¸€ä¸ªäºº", zh: "ä¸€ä¸ªäºº", en: "one person; alone", ru: "Ğ¾Ğ´Ğ¸Ğ½ Ñ‡ĞµĞ»Ğ¾Ğ²ĞµĞº; Ğ² Ğ¾Ğ´Ğ¸Ğ½Ğ¾Ñ‡ĞºÑƒ" },
  { id: "l1-ä¸­å›½äºº", zh: "ä¸­å›½äºº", en: "Chinese (person)", ru: "ĞºĞ¸Ñ‚Ğ°ĞµÑ†/ĞºĞ¸Ñ‚Ğ°ÑĞ½ĞºĞ°" },
  { id: "l1-å…«ä¸ªå­¦ç”Ÿ", zh: "å…«ä¸ªå­¦ç”Ÿ", en: "eight students", ru: "Ğ²Ğ¾ÑĞµĞ¼ÑŒ ÑÑ‚ÑƒĞ´ĞµĞ½Ñ‚Ğ¾Ğ²" },
  { id: "l1-ä¸‰ä¸ªä¸­å›½äºº", zh: "ä¸‰ä¸ªä¸­å›½äºº", en: "three Chinese people", ru: "Ñ‚Ñ€Ğ¾Ğµ ĞºĞ¸Ñ‚Ğ°Ğ¹Ñ†ĞµĞ²" },
  { id: "l1-ä»Šå¤©", zh: "ä»Šå¤©", en: "today", ru: "ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ" },
  { id: "l1-æ˜å¤©", zh: "æ˜å¤©", en: "tomorrow", ru: "Ğ·Ğ°Ğ²Ñ‚Ñ€Ğ°" },
  { id: "l1-ä¸‹è¯¾", zh: "ä¸‹è¯¾", en: "finish class", ru: "Ğ·Ğ°ĞºĞ°Ğ½Ñ‡Ğ¸Ğ²Ğ°Ñ‚ÑŒ ÑƒÑ€Ğ¾Ğº" },
  { id: "l1-å…­å", zh: "å…­å", en: "sixty", ru: "ÑˆĞµÑÑ‚ÑŒĞ´ĞµÑÑÑ‚" },
  { id: "l1-å…­åƒ", zh: "å…­åƒ", en: "six thousand", ru: "ÑˆĞµÑÑ‚ÑŒ Ñ‚Ñ‹ÑÑÑ‡" },
  { id: "l1-å­¦ä¹ ", zh: "å­¦ä¹ ", en: "study; learn", ru: "ÑƒÑ‡Ğ¸Ñ‚ÑŒÑÑ; Ğ¸Ğ·ÑƒÑ‡Ğ°Ñ‚ÑŒ" },
];

const L2 = [
  { id: "l2-å·¥äºº", zh: "å·¥äºº", en: "worker", ru: "Ñ€Ğ°Ğ±Ğ¾Ñ‡Ğ¸Ğ¹" },
  { id: "l2-å·¥ä½œ", zh: "å·¥ä½œ", en: "work; job", ru: "Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ; Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°" },
  { id: "l2-å¹²ä»€ä¹ˆ", zh: "å¹²ä»€ä¹ˆ", en: "do what? what for?", ru: "Ñ‡Ñ‚Ğ¾ Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ? Ğ·Ğ°Ñ‡ĞµĞ¼?" },
  { id: "l2-åœŸè±†", zh: "åœŸè±†", en: "potato", ru: "ĞºĞ°Ñ€Ñ‚Ğ¾Ñ„ĞµĞ»ÑŒ" },
  { id: "l2-ç‹è€å¸ˆ", zh: "ç‹è€å¸ˆ", en: "Teacher Wang", ru: "ÑƒÑ‡Ğ¸Ñ‚ĞµĞ»ÑŒ Ğ’Ğ°Ğ½" },
  { id: "l2-æˆ‘å§“ç‹", zh: "æˆ‘å§“ç‹", en: "My surname is Wang", ru: "ĞœĞ¾Ñ Ñ„Ğ°Ğ¼Ğ¸Ğ»Ğ¸Ñ Ğ’Ğ°Ğ½" },
  { id: "l2-ç‰›å¥¶", zh: "ç‰›å¥¶", en: "milk", ru: "Ğ¼Ğ¾Ğ»Ğ¾ĞºĞ¾" },
  { id: "l2-ç‰›è‚‰", zh: "ç‰›è‚‰", en: "beef", ru: "Ğ³Ğ¾Ğ²ÑĞ´Ğ¸Ğ½Ğ°" },
  { id: "l2-å·¥å‚", zh: "å·¥å‚", en: "factory", ru: "Ñ„Ğ°Ğ±Ñ€Ğ¸ĞºĞ°; Ğ·Ğ°Ğ²Ğ¾Ğ´" },
  { id: "l2-å¹¿å‘Š", zh: "å¹¿å‘Š", en: "advertisement", ru: "Ñ€ĞµĞºĞ»Ğ°Ğ¼Ğ°" },
  { id: "l2-å¤§å­¦", zh: "å¤§å­¦", en: "university", ru: "ÑƒĞ½Ğ¸Ğ²ĞµÑ€ÑĞ¸Ñ‚ĞµÑ‚" },
  { id: "l2-å¤ªå¥½äº†", zh: "å¤ªå¥½äº†", en: "Great! Awesome!", ru: "Ğ—Ğ´Ğ¾Ñ€Ğ¾Ğ²Ğ¾! ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾!" },
  { id: "l2-å¼€é—¨", zh: "å¼€é—¨", en: "open the door", ru: "Ğ¾Ñ‚ĞºÑ€Ñ‹Ğ²Ğ°Ñ‚ÑŒ Ğ´Ğ²ĞµÑ€ÑŒ" },
  { id: "l2-å¼€å§‹", zh: "å¼€å§‹", en: "start; begin", ru: "Ğ½Ğ°Ñ‡Ğ¸Ğ½Ğ°Ñ‚ÑŒ(ÑÑ)" },
  { id: "l2-å…³é—¨", zh: "å…³é—¨", en: "close the door", ru: "Ğ·Ğ°ĞºÑ€Ñ‹Ğ²Ğ°Ñ‚ÑŒ Ğ´Ğ²ĞµÑ€ÑŒ" },
  { id: "l2-æœ¨é—¨", zh: "æœ¨é—¨", en: "wooden door", ru: "Ğ´ĞµÑ€ĞµĞ²ÑĞ½Ğ½Ğ°Ñ Ğ´Ğ²ĞµÑ€ÑŒ" },
  { id: "l2-æœ¬å­", zh: "æœ¬å­", en: "notebook", ru: "Ñ‚ĞµÑ‚Ñ€Ğ°Ğ´ÑŒ" },
  { id: "l2-ä¸€æœ¬ä¹¦", zh: "ä¸€æœ¬ä¹¦", en: "one book", ru: "Ğ¾Ğ´Ğ½Ğ° ĞºĞ½Ğ¸Ğ³Ğ°" },
  { id: "l2-ä¸æ˜¯", zh: "ä¸æ˜¯", en: "to not be", ru: "Ğ½Ğµ ÑĞ²Ğ»ÑÑ‚ÑŒÑÑ" },
  { id: "l2-ä¸å¥½", zh: "ä¸å¥½", en: "not good", ru: "Ğ¿Ğ»Ğ¾Ñ…Ğ¾; Ğ½Ğµ Ñ…Ğ¾Ñ€Ğ¾ÑˆĞ¸Ğ¹" },
  { id: "l2-ä¸­æ–‡", zh: "ä¸­æ–‡", en: "Chinese (language)", ru: "ĞºĞ¸Ñ‚Ğ°Ğ¹ÑĞºĞ¸Ğ¹ ÑĞ·Ñ‹Ğº" },
  { id: "l2-è‹±æ–‡", zh: "è‹±æ–‡", en: "English (language)", ru: "Ğ°Ğ½Ğ³Ğ»Ğ¸Ğ¹ÑĞºĞ¸Ğ¹ ÑĞ·Ñ‹Ğº" },
  { id: "l2-å¤šå°‘", zh: "å¤šå°‘", en: "how many/much", ru: "ÑĞºĞ¾Ğ»ÑŒĞºĞ¾" },
  { id: "l2-å¾ˆå°‘", zh: "å¾ˆå°‘", en: "very few; seldom", ru: "Ğ¾Ñ‡ĞµĞ½ÑŒ Ğ¼Ğ°Ğ»Ğ¾; Ñ€ĞµĞ´ĞºĞ¾" },
  { id: "l2-æ¥ä¸­å›½", zh: "æ¥ä¸­å›½", en: "come to China", ru: "Ğ¿Ñ€Ğ¸ĞµÑ…Ğ°Ñ‚ÑŒ Ğ² ĞšĞ¸Ñ‚Ğ°Ğ¹" },
  { id: "l2-æ¥åŒ—äº¬", zh: "æ¥åŒ—äº¬", en: "come to Beijing", ru: "Ğ¿Ñ€Ğ¸ĞµÑ…Ğ°Ñ‚ÑŒ Ğ² ĞŸĞµĞºĞ¸Ğ½" },
  { id: "l2-èµ°è·¯", zh: "èµ°è·¯", en: "walk; on foot", ru: "Ğ¸Ğ´Ñ‚Ğ¸ Ğ¿ĞµÑˆĞºĞ¾Ğ¼" },
  { id: "l2-ä½œä¸š", zh: "ä½œä¸š", en: "homework", ru: "Ğ´Ğ¾Ğ¼Ğ°ÑˆĞ½ĞµĞµ Ğ·Ğ°Ğ´Ğ°Ğ½Ğ¸Ğµ" },
  { id: "l2-ç«è½¦", zh: "ç«è½¦", en: "train", ru: "Ğ¿Ğ¾ĞµĞ·Ğ´" },
  { id: "l2-ä¸€æ–¤", zh: "ä¸€æ–¤", en: "one jin (â‰ˆ500g)", ru: "Ğ¾Ğ´Ğ¸Ğ½ Ñ†Ğ·Ğ¸Ğ½ÑŒ (â‰ˆ500 Ğ³)" },
  { id: "l2-å…«æ–¤", zh: "å…«æ–¤", en: "eight jin (â‰ˆ4 kg)", ru: "Ğ²Ğ¾ÑĞµĞ¼ÑŒ Ñ†Ğ·Ğ¸Ğ½ĞµĞ¹ (â‰ˆ4 ĞºĞ³)" },
  { id: "l2-ä»Šå¹´", zh: "ä»Šå¹´", en: "this year", ru: "Ğ² ÑÑ‚Ğ¾Ğ¼ Ğ³Ğ¾Ğ´Ñƒ" },
  { id: "l2-æ˜å¹´", zh: "æ˜å¹´", en: "next year", ru: "Ğ² ÑĞ»ĞµĞ´ÑƒÑÑ‰ĞµĞ¼ Ğ³Ğ¾Ğ´Ñƒ" },
  { id: "l2-å¤´å‘", zh: "å¤´å‘", en: "hair (on head)", ru: "Ğ²Ğ¾Ğ»Ğ¾ÑÑ‹" },
  { id: "l2-ç”µè¯å¡", zh: "ç”µè¯å¡", en: "SIM/phone card", ru: "Ñ‚ĞµĞ»ĞµÑ„Ğ¾Ğ½Ğ½Ğ°Ñ SIM-ĞºĞ°Ñ€Ñ‚Ğ°" },
  { id: "l2-ä¸€å¼ å¡", zh: "ä¸€å¼ å¡", en: "one card", ru: "Ğ¾Ğ´Ğ½Ğ° ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ°" },
  { id: "l2-ä¸€å…±", zh: "ä¸€å…±", en: "in total; altogether", ru: "Ğ²ÑĞµĞ³Ğ¾; Ğ¸Ñ‚Ğ¾Ğ³Ğ¾" },
];

const ALL = [...L1, ...L2];

/** =======================
 *  Persistence
 *  ======================= */
const STORAGE_KEY = "ecc-l1l2-progress-v1";
function loadProgress() {
  try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || {}; }
  catch { return {}; }
}
function saveProgress(data) {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
}

/** =======================
 *  Core Components
 *  ======================= */
function Header({deckName, mode, setMode, stats, onReset}) {
  return (
    <div className="sticky top-0 z-20 bg-[#f6fff8]/80 backdrop-blur border-b">
      <div className="max-w-6xl mx-auto px-4 py-3 flex items-center gap-3 justify-between">
        <div className="flex items-center gap-3">
          <div className="text-2xl font-semibold text-green-700">å­—æ„Ÿç»ƒä¹  Â· ECC</div>
          <span className="chip">Deck: {deckName}</span>
          <span className="chip">Mastered: {stats.mastered}/{stats.total} ({stats.percent}%)</span>
        </div>
        <div className="flex items-center gap-2">
          {["Flashcards","Quiz","Type-It","Mini-Game","List"].map(m=>(
            <button key={m}
                    className={"btn btn-soft "+(mode===m?"border-green-600":"")}
                    onClick={()=>setMode(m)}>{m}</button>
          ))}
          <button className="btn btn-soft" onClick={onReset}>Reset</button>
        </div>
      </div>
    </div>
  )
}

function DeckPicker({deck, setDeck}) {
  return (
    <div className="max-w-6xl mx-auto px-4 pt-4 pb-2">
      <div className="flex flex-wrap gap-2">
        <button
          className={"btn "+(deck==="ALL"?"btn-primary":"btn-soft")}
          onClick={()=>setDeck("ALL")}
        >L1 & L2ï¼ˆåˆå¹¶ï¼‰</button>
        <button
          className={"btn "+(deck==="L1"?"btn-primary":"btn-soft")}
          onClick={()=>setDeck("L1")}
        >L1</button>
        <button
          className={"btn "+(deck==="L2"?"btn-primary":"btn-soft")}
          onClick={()=>setDeck("L2")}
        >L2</button>
      </div>
      <p className="text-xs text-gray-500 mt-2">
        Hotkeys in Flashcards: <span class="kbd">Space</span> flip,
        <span class="ml-1 kbd">K</span> knew,
        <span class="ml-1 kbd">A</span> again,
        <span class="ml-1 kbd">V</span> voice.
      </p>
    </div>
  )
}

/** ---------- Flashcards ---------- */
function Flashcards({items, progress, updateProgress}) {
  const [i, setI] = React.useState(0);
  const [showBack, setShowBack] = React.useState(false);

  const card = items[i];

  React.useEffect(()=>{
    const handler = (e)=>{
      if (e.target.tagName === "INPUT" || e.target.tagName === "TEXTAREA") return;
      if (e.code === "Space") { e.preventDefault(); setShowBack(s=>!s); }
      if (e.key.toLowerCase() === "k") knew();
      if (e.key.toLowerCase() === "a") again();
      if (e.key.toLowerCase() === "v") speakNow();
    };
    window.addEventListener("keydown", handler);
    return ()=>window.removeEventListener("keydown", handler);
  }, [i, showBack, items]);

  const next = () => {
    setShowBack(false);
    setI((i+1) % items.length);
  };
  const prev = () => {
    setShowBack(false);
    setI((i-1+items.length) % items.length);
  };

  const mastery = progress[card.id]?.m ?? 0;

  const knew = () => {
    const m = Math.min(5, mastery + 1);
    updateProgress(card.id, m);
    next();
  };
  const again = () => {
    const m = Math.max(0, mastery - 1);
    updateProgress(card.id, m);
  };
  const speakNow = () => speak(card.zh, 'zh-CN');

  return (
    <div className="max-w-4xl mx-auto p-4">
      <div className="flex items-center justify-between mb-3">
        <div className="text-sm text-gray-500">Card {i+1}/{items.length}</div>
        <div className="flex gap-1 items-center">
          <span className="chip">Mastery: {mastery}/5</span>
        </div>
      </div>
      <div className="card p-6 md:p-10 text-center select-none">
        <div className="text-sm text-gray-400 mb-2">{showBack? "Meaning":"Chinese"}</div>
        <div className={"font-bold "+(showBack?"text-2xl":"text-6xl md:text-7xl")}>
          {showBack
            ? (<div>
                <div className="text-2xl">{card.en}</div>
                <div className="text-gray-500 mt-1">{card.ru}</div>
              </div>)
            : card.zh}
        </div>

        <div className="mt-6 flex flex-wrap justify-center gap-2">
          <button className="btn btn-soft" onClick={prev}>â† Prev</button>
          <button className="btn btn-soft" onClick={()=>setShowBack(s=>!s)}>Flip (Space)</button>
          <button className="btn btn-soft" onClick={speakNow}>ğŸ”Š Voice (V)</button>
          <button className="btn btn-soft" onClick={again}>Again (A)</button>
          <button className="btn btn-primary" onClick={knew}>Knew (K)</button>
          <button className="btn btn-soft" onClick={next}>Next â†’</button>
        </div>
      </div>
    </div>
  );
}

/** ---------- Quiz (MCQ) ---------- */
function Quiz({items, updateProgress}) {
  const makeQ = () => {
    const correct = sample(items);
    const wrongs = shuffle(items.filter(w => w.id !== correct.id)).slice(0,3);
    const opts = shuffle([correct, ...wrongs]);
    return { correct, opts };
  };
  const [q, setQ] = React.useState(makeQ());
  const [picked, setPicked] = React.useState(null);

  const choose = (opt) => {
    setPicked(opt.id);
    if (opt.id === q.correct.id) {
      updateProgress(q.correct.id, "+1");
      speak(q.correct.zh, 'zh-CN');
      setTimeout(()=>{ setPicked(null); setQ(makeQ()); }, 600);
    } else {
      updateProgress(q.correct.id, "-1");
    }
  };

  return (
    <div className="max-w-4xl mx-auto p-4">
      <div className="card p-6 md:p-8">
        <div className="text-center text-sm text-gray-500 mb-2">Choose the correct meaning</div>
        <div className="text-center text-5xl md:text-6xl font-bold mb-6">{q.correct.zh}</div>
        <div className="grid md:grid-cols-2 gap-3">
          {q.opts.map(opt=>(
            <button key={opt.id}
              onClick={()=>choose(opt)}
              className={
                "btn btn-soft justify-start text-left " +
                (picked && opt.id===q.correct.id ? "border-green-600" : "") +
                (picked && opt.id===picked && picked!==q.correct.id ? "border-red-400" : "")
              }>
              <div className="font-medium">{opt.en}</div>
              <div className="text-xs text-gray-500">{opt.ru}</div>
            </button>
          ))}
        </div>
      </div>
    </div>
  )
}

/** ---------- Type-It ---------- */
function TypeIt({items, updateProgress}) {
  const [i, setI] = React.useState(0);
  const [val, setVal] = React.useState("");
  const [ok, setOk] = React.useState(null);

  const w = items[i];

  const submit = (e) => {
    e.preventDefault();
    const correct = val.trim() === w.zh;
    setOk(correct);
    if (correct) {
      updateProgress(w.id, "+1");
      speak(w.zh, 'zh-CN');
      setTimeout(()=>{
        setI((i+1)%items.length);
        setVal(""); setOk(null);
      }, 500);
    } else {
      updateProgress(w.id, "-1");
    }
  };

  return (
    <div className="max-w-xl mx-auto p-4">
      <div className="card p-6 md:p-8">
        <div className="text-center text-sm text-gray-500 mb-1">Type the Chinese characters</div>
        <div className="text-center font-semibold">{w.en}</div>
        <div className="text-center text-gray-500 text-sm">{w.ru}</div>
        <form onSubmit={submit} className="mt-5 flex gap-2">
          <input className="flex-1 border rounded-xl px-3 py-2"
                 placeholder="Type here in Chineseâ€¦"
                 value={val} onChange={e=>setVal(e.target.value)} />
          <button className="btn btn-primary">Check</button>
        </form>
        {ok===true && <div className="mt-3 text-green-700">âœ” æ­£ç¡®ï¼ {w.zh}</div>}
        {ok===false && <div className="mt-3 text-red-600">âœ˜ å†è¯•ä¸€æ¬¡ï½ æ­£ç¡®ç­”æ¡ˆï¼š{w.zh}</div>}
      </div>
    </div>
  )
}

/** ---------- Mini Drag & Drop ---------- */
function MiniGame({items, updateProgress}) {
  const roundWords = React.useMemo(()=>shuffle(items).slice(0,6), [items]);
  const [targets, setTargets] = React.useState(shuffle(roundWords));
  const [done, setDone] = React.useState({}); // id -> matched?

  const onDragStart = (e, id) => e.dataTransfer.setData("text/id", id);
  const onDrop = (e, targetId) => {
    const dragged = e.dataTransfer.getData("text/id");
    if (!dragged) return;
    if (dragged === targetId) {
      setDone(d => ({...d, [targetId]: true}));
      updateProgress(targetId, "+1");
      const w = roundWords.find(x=>x.id===targetId);
      speak(w.zh, 'zh-CN');
    } else {
      updateProgress(targetId, "-1");
    }
  };

  const complete = Object.values(done).filter(Boolean).length === roundWords.length;

  return (
    <div className="max-w-5xl mx-auto p-4">
      <div className="grid md:grid-cols-2 gap-6">
        <div className="card p-4">
          <div className="text-sm text-gray-500 mb-2">Drag these Chinese words</div>
          <div className="flex flex-wrap gap-2">
            {roundWords.map(w=>(
              <div key={"drag-"+w.id}
                   draggable={!done[w.id]}
                   onDragStart={(e)=>onDragStart(e, w.id)}
                   className={"px-3 py-2 rounded-xl border bg-white cursor-move select-none "+(done[w.id]?"opacity-40 line-through":"")}>
                {w.zh}
              </div>
            ))}
          </div>
        </div>

        <div className="card p-4">
          <div className="text-sm text-gray-500 mb-2">Drop onto the matching meaning</div>
          <div className="grid sm:grid-cols-2 gap-2">
            {targets.map(w=>(
              <div key={"tgt-"+w.id}
                   onDragOver={(e)=>e.preventDefault()}
                   onDrop={(e)=>onDrop(e, w.id)}
                   className={
                     "p-3 rounded-xl border min-h-[56px] bg-white " +
                     (done[w.id] ? "border-green-600" : "border-dashed")
                   }>
                <div className="font-medium">{w.en}</div>
                <div className="text-xs text-gray-500">{w.ru}</div>
              </div>
            ))}
          </div>
          {complete && <div className="mt-3 text-green-700 font-medium">Nice! All matched ğŸ‰</div>}
        </div>
      </div>
    </div>
  )
}

/** ---------- Wordlist (reference) ---------- */
function WordList({items, progress}) {
  const [q, setQ] = React.useState("");
  const filtered = items.filter(w =>
    w.zh.includes(q) || w.en.toLowerCase().includes(q.toLowerCase()) || w.ru.toLowerCase().includes(q.toLowerCase())
  );
  return (
    <div className="max-w-6xl mx-auto p-4">
      <div className="flex items-center justify-between">
        <h3 className="text-lg font-semibold">Wordlist</h3>
        <input className="border rounded-xl px-3 py-1.5 w-60"
               placeholder="Searchâ€¦" value={q} onChange={e=>setQ(e.target.value)} />
      </div>
      <div className="mt-3 overflow-auto">
        <table className="w-full text-sm">
          <thead>
            <tr className="text-left text-gray-500">
              <th className="py-2 pr-3">#</th>
              <th className="py-2 pr-3">æ±‰å­—</th>
              <th className="py-2 pr-3">English</th>
              <th className="py-2 pr-3">Ğ ÑƒÑÑĞºĞ¸Ğ¹</th>
              <th className="py-2 pr-3">Mastery</th>
              <th className="py-2 pr-3">Speak</th>
            </tr>
          </thead>
          <tbody>
            {filtered.map((w,idx)=>(
              <tr key={w.id} className="border-t">
                <td className="py-2 pr-3">{idx+1}</td>
                <td className="py-2 pr-3 font-medium">{w.zh}</td>
                <td className="py-2 pr-3">{w.en}</td>
                <td className="py-2 pr-3 text-gray-600">{w.ru}</td>
                <td className="py-2 pr-3">{(progress[w.id]?.m||0)}/5</td>
                <td className="py-2 pr-3">
                  <button className="btn btn-soft" onClick={()=>speak(w.zh,'zh-CN')}>ğŸ”Š</button>
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  )
}

/** ---------- App ---------- */
function App(){
  const [deck, setDeck] = React.useState("ALL");
  const [mode, setMode] = React.useState("Flashcards");
  const [progress, setProgress] = React.useState(loadProgress());

  const items = React.useMemo(()=>{
    if (deck==="L1") return L1;
    if (deck==="L2") return L2;
    return ALL;
  }, [deck]);

  const updateProgress = (id, value) => {
    setProgress(prev=>{
      const cur = prev[id]?.m ?? 0;
      let m;
      if (typeof value === "string") {
        if (value === "+1") m = Math.min(5, cur+1);
        else if (value === "-1") m = Math.max(0, cur-1);
      } else {
        m = value;
      }
      const next = { ...prev, [id]: { m } };
      saveProgress(next);
      return next;
    });
  };

  const stats = React.useMemo(()=>{
    const total = items.length;
    const mastered = items.filter(w => (progress[w.id]?.m||0) >= 4).length;
    const percent = total ? Math.round(mastered*100/total) : 0;
    return { total, mastered, percent };
  }, [items, progress]);

  const onReset = () => {
    if (confirm("Clear all progress?")) {
      localStorage.removeItem(STORAGE_KEY);
      setProgress({});
    }
  };

  return (
    <div>
      <Header deckName={deck==="ALL"?"L1&L2":" "+deck}
              mode={mode} setMode={setMode}
              stats={stats} onReset={onReset}/>
      <DeckPicker deck={deck} setDeck={setDeck}/>
      {mode==="Flashcards" && <Flashcards items={items} progress={progress} updateProgress={updateProgress}/>}
      {mode==="Quiz" && <Quiz items={items} updateProgress={updateProgress}/>}
      {mode==="Type-It" && <TypeIt items={items} updateProgress={updateProgress}/>}
      {mode==="Mini-Game" && <MiniGame items={items} updateProgress={updateProgress}/>}
      {mode==="List" && <WordList items={items} progress={progress}/>}
      <footer className="max-w-6xl mx-auto px-4 py-8 text-xs text-gray-500">
        <div className="flex flex-wrap gap-2 items-center">
          <span className="chip">Theme: fresh green</span>
          <span className="chip">Responsive</span>
          <span className="chip">LocalStorage progress</span>
          <span className="chip">Hotkeys: Space/K/A/V</span>
        </div>
      </footer>
    </div>
  );
}

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<App/>);
  </script>
</body>
</html>
