<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chinese Character Learning App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;700&display=swap');
        
        body {
            font-family: 'Noto Sans SC', sans-serif;
        }
        
        .card {
            perspective: 1000px;
            height: 250px;
        }
        
        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        
        .card.flipped .card-inner {
            transform: rotateY(180deg);
        }
        
        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            padding: 20px;
        }
        
        .card-back {
            transform: rotateY(180deg);
        }
        
        .progress-bar {
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            transition: width 0.3s ease;
        }
        
        .game-item {
            transition: all 0.3s ease;
        }
        
        .game-item.dragging {
            opacity: 0.5;
        }
        
        .drop-zone {
            transition: all 0.3s ease;
        }
        
        .drop-zone.highlight {
            background-color: rgba(72, 187, 120, 0.2);
            border-color: #48bb78;
        }
    </style>
</head>
<body class="bg-green-50 min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Word data with Chinese, English, and Russian translations
        const wordData = {
            L1: [
                { chinese: "一个", english: "one", russian: "один" },
                { chinese: "一天", english: "one day", russian: "один день" },
                { chinese: "二十", english: "twenty", russian: "двадцать" },
                { chinese: "十二", english: "twelve", russian: "двенадцать" },
                { chinese: "三十", english: "thirty", russian: "тридцать" },
                { chinese: "十三", english: "thirteen", russian: "тринадцать" },
                { chinese: "十一", english: "eleven", russian: "одиннадцать" },
                { chinese: "三十二", english: "thirty-two", russian: "тридцать два" },
                { chinese: "上午", english: "morning", russian: "утро" },
                { chinese: "上课", english: "attend class", russian: "посещать занятия" },
                { chinese: "一千", english: "one thousand", russian: "одна тысяча" },
                { chinese: "三千", english: "three thousand", russian: "три тысячи" },
                { chinese: "下午", english: "afternoon", russian: "после полудня" },
                { chinese: "学生", english: "student", russian: "студент" },
                { chinese: "一个学生", english: "one student", russian: "один студент" },
                { chinese: "十八", english: "eighteen", russian: "восемнадцать" },
                { chinese: "八十", english: "eighty", russian: "восемьдесят" },
                { chinese: "一个人", english: "one person", russian: "один человек" },
                { chinese: "中国人", english: "Chinese person", russian: "китаец" },
                { chinese: "八个学生", english: "eight students", russian: "восемь студентов" },
                { chinese: "三个中国人", english: "three Chinese people", russian: "три китайца" },
                { chinese: "今天", english: "today", russian: "сегодня" },
                { chinese: "明天", english: "tomorrow", russian: "завтра" },
                { chinese: "下课", english: "finish class", russian: "закончить занятия" },
                { chinese: "六十", english: "sixty", russian: "шестьдесят" },
                { chinese: "六千", english: "six thousand", russian: "шесть тысяч" },
                { chinese: "学习", english: "study", russian: "учиться" }
            ],
            L2: [
                { chinese: "工人", english: "worker", russian: "рабочий" },
                { chinese: "工作", english: "work", russian: "работать" },
                { chinese: "干什么", english: "what to do", russian: "что делать" },
                { chinese: "土豆", english: "potato", russian: "картофель" },
                { chinese: "王老师", english: "Teacher Wang", russian: "Учитель Ван" },
                { chinese: "我姓王", english: "My surname is Wang", russian: "Моя фамилия Ван" },
                { chinese: "牛奶", english: "milk", russian: "молоко" },
                { chinese: "牛肉", english: "beef", russian: "говядина" },
                { chinese: "工厂", english: "factory", russian: "фабрика" },
                { chinese: "广告", english: "advertisement", russian: "реклама" },
                { chinese: "大学", english: "university", russian: "университет" },
                { chinese: "太好了", english: "great", russian: "отлично" },
                { chinese: "开门", english: "open the door", russian: "открыть дверь" },
                { chinese: "开始", english: "start", russian: "начать" },
                { chinese: "关门", english: "close the door", russian: "закрыть дверь" },
                { chinese: "木门", english: "wooden door", russian: "деревянная дверь" },
                { chinese: "本子", english: "notebook", russian: "тетрадь" },
                { chinese: "一本书", english: "a book", russian: "книга" },
                { chinese: "不是", english: "is not", russian: "не является" },
                { chinese: "不好", english: "not good", russian: "не хорошо" },
                { chinese: "中文", english: "Chinese language", russian: "китайский язык" },
                { chinese: "英文", english: "English language", russian: "английский язык" },
                { chinese: "多少", english: "how much", russian: "сколько" },
                { chinese: "很少", english: "very little", russian: "очень мало" },
                { chinese: "来中国", english: "come to China", russian: "приехать в Китай" },
                { chinese: "来北京", english: "come to Beijing", russian: "приехать в Пекин" },
                { chinese: "走路", english: "walk", russian: "ходить пешком" },
                { chinese: "作业", english: "homework", russian: "домашнее задание" },
                { chinese: "火车", english: "train", russian: "поезд" },
                { chinese: "一斤", english: "one jin (500g)", russian: "один цзинь (500г)" },
                { chinese: "八斤", english: "eight jin", russian: "восемь цзиней" },
                { chinese: "今年", english: "this year", russian: "этот год" },
                { chinese: "明年", english: "next year", russian: "следующий год" },
                { chinese: "头发", english: "hair", russian: "волосы" },
                { chinese: "电话卡", english: "phone card", russian: "телефонная карта" },
                { chinese: "一张卡", english: "one card", russian: "одна карта" },
                { chinese: "一共", english: "altogether", russian: "всего" }
            ]
        };

        // Create combined deck
        wordData.L1L2 = [...wordData.L1, ...wordData.L2];

        // App component
        function App() {
            const [currentMode, setCurrentMode] = useState('flashcards');
            const [currentDeck, setCurrentDeck] = useState('L1');
            const [progress, setProgress] = useState({});
            const [showWordList, setShowWordList] = useState(false);

            // Load progress from localStorage on initial render
            useEffect(() => {
                const savedProgress = localStorage.getItem('chineseLearningProgress');
                if (savedProgress) {
                    setProgress(JSON.parse(savedProgress));
                }
            }, []);

            // Save progress to localStorage whenever it changes
            useEffect(() => {
                localStorage.setItem('chineseLearningProgress', JSON.stringify(progress));
            }, [progress]);

            // Update progress for a word
            const updateProgress = (word, mastery) => {
                setProgress(prev => ({
                    ...prev,
                    [word]: mastery
                }));
            };

            // Reset progress
            const resetProgress = () => {
                if (window.confirm("Are you sure you want to reset all progress?")) {
                    setProgress({});
                }
            };

            // Calculate mastery stats
            const calculateStats = () => {
                const deckWords = wordData[currentDeck];
                const mastered = deckWords.filter(word => progress[word.chinese] >= 4).length;
                const total = deckWords.length;
                const percentage = total > 0 ? Math.round((mastered / total) * 100) : 0;
                
                return { mastered, total, percentage };
            };

            const stats = calculateStats();

            // Render current mode component
            const renderMode = () => {
                switch(currentMode) {
                    case 'flashcards':
                        return <Flashcards 
                            deck={wordData[currentDeck]} 
                            progress={progress} 
                            updateProgress={updateProgress} 
                        />;
                    case 'quiz':
                        return <Quiz 
                            deck={wordData[currentDeck]} 
                            progress={progress} 
                            updateProgress={updateProgress} 
                        />;
                    case 'type':
                        return <TypeIt 
                            deck={wordData[currentDeck]} 
                            progress={progress} 
                            updateProgress={updateProgress} 
                        />;
                    case 'game':
                        return <MiniGame 
                            deck={wordData[currentDeck]} 
                            progress={progress} 
                            updateProgress={updateProgress} 
                        />;
                    default:
                        return <Flashcards 
                            deck={wordData[currentDeck]} 
                            progress={progress} 
                            updateProgress={updateProgress} 
                        />;
                }
            };

            return (
                <div className="min-h-screen bg-gradient-to-b from-green-50 to-green-100">
                    {/* Header */}
                    <header className="bg-green-600 text-white shadow-md">
                        <div className="container mx-auto px-4 py-4">
                            <h1 className="text-2xl font-bold text-center">Chinese Character Learning</h1>
                            <p className="text-center text-green-100 mt-1">Master Chinese characters through interactive exercises</p>
                        </div>
                    </header>

                    {/* Navigation */}
                    <nav className="bg-white shadow-sm sticky top-0 z-10">
                        <div className="container mx-auto px-4 py-2">
                            <div className="flex flex-wrap justify-between items-center">
                                {/* Mode Selector */}
                                <div className="flex space-x-2 mb-2 md:mb-0">
                                    {['flashcards', 'quiz', 'type', 'game'].map(mode => (
                                        <button
                                            key={mode}
                                            className={`px-3 py-1 rounded-full text-sm font-medium ${currentMode === mode ? 'bg-green-500 text-white' : 'bg-green-100 text-green-800 hover:bg-green-200'}`}
                                            onClick={() => setCurrentMode(mode)}
                                        >
                                            {mode === 'flashcards' && 'Flashcards'}
                                            {mode === 'quiz' && 'Quiz'}
                                            {mode === 'type' && 'Type It'}
                                            {mode === 'game' && 'Mini Game'}
                                        </button>
                                    ))}
                                </div>

                                {/* Deck Selector */}
                                <div className="flex space-x-2">
                                    {['L1', 'L2', 'L1L2'].map(deck => (
                                        <button
                                            key={deck}
                                            className={`px-3 py-1 rounded-full text-sm font-medium ${currentDeck === deck ? 'bg-green-500 text-white' : 'bg-green-100 text-green-800 hover:bg-green-200'}`}
                                            onClick={() => setCurrentDeck(deck)}
                                        >
                                            {deck === 'L1' && 'Lesson 1'}
                                            {deck === 'L2' && 'Lesson 2'}
                                            {deck === 'L1L2' && 'All Words'}
                                        </button>
                                    ))}
                                </div>
                            </div>
                        </div>
                    </nav>

                    {/* Main Content */}
                    <main className="container mx-auto px-4 py-6">
                        {/* Progress Bar */}
                        <div className="bg-white rounded-lg shadow p-4 mb-6">
                            <div className="flex justify-between items-center mb-2">
                                <span className="text-sm font-medium text-green-800">Mastery Progress</span>
                                <span className="text-sm font-medium text-green-800">{stats.mastered}/{stats.total} ({stats.percentage}%)</span>
                            </div>
                            <div className="progress-bar bg-green-200">
                                <div 
                                    className="progress-fill bg-green-500" 
                                    style={{ width: `${stats.percentage}%` }}
                                ></div>
                            </div>
                            <div className="flex justify-end mt-2">
                                <button 
                                    className="text-sm text-red-500 hover:text-red-700"
                                    onClick={resetProgress}
                                >
                                    Reset Progress
                                </button>
                            </div>
                        </div>

                        {/* Current Mode Component */}
                        {renderMode()}

                        {/* Word List Toggle */}
                        <div className="text-center mt-8">
                            <button 
                                className="bg-green-500 hover:bg-green-600 text-white font-medium py-2 px-4 rounded-full"
                                onClick={() => setShowWordList(!showWordList)}
                            >
                                {showWordList ? 'Hide Word List' : 'Show Word List'}
                            </button>
                        </div>

                        {/* Word List */}
                        {showWordList && (
                            <div className="mt-6 bg-white rounded-lg shadow p-4">
                                <h2 className="text-xl font-bold text-green-800 mb-4">Word List - {currentDeck}</h2>
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    {wordData[currentDeck].map((word, index) => (
                                        <div 
                                            key={index} 
                                            className="border border-green-200 rounded-lg p-3 flex justify-between items-center"
                                        >
                                            <div>
                                                <div className="font-bold text-lg">{word.chinese}</div>
                                                <div className="text-sm text-gray-600">{word.english}</div>
                                                <div className="text-sm text-gray-500">{word.russian}</div>
                                            </div>
                                            <div className="text-right">
                                                <div className={`text-xs font-medium px-2 py-1 rounded-full ${(progress[word.chinese] || 0) >= 4 ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}`}>
                                                    Mastery: {progress[word.chinese] || 0}/5
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                    </main>

                    {/* Footer */}
                    <footer className="bg-green-800 text-green-200 py-4 mt-8">
                        <div className="container mx-auto px-4 text-center">
                            <p>Chinese Character Learning App - Practice and master Chinese characters</p>
                        </div>
                    </footer>
                </div>
            );
        }

        // Flashcards Component
        function Flashcards({ deck, progress, updateProgress }) {
            const [currentIndex, setCurrentIndex] = useState(0);
            const [isFlipped, setIsFlipped] = useState(false);
            const cardRef = useRef(null);

            // Handle keyboard shortcuts
            useEffect(() => {
                const handleKeyDown = (e) => {
                    if (e.code === 'Space') {
                        e.preventDefault();
                        setIsFlipped(!isFlipped);
                    } else if (e.code === 'KeyK') {
                        e.preventDefault();
                        handleKnewIt();
                    } else if (e.code === 'KeyA') {
                        e.preventDefault();
                        handleAgain();
                    } else if (e.code === 'KeyV') {
                        e.preventDefault();
                        speakWord();
                    }
                };

                window.addEventListener('keydown', handleKeyDown);
                return () => window.removeEventListener('keydown', handleKeyDown);
            }, [isFlipped, currentIndex]);

            const currentWord = deck[currentIndex];

            const handleNext = () => {
                setIsFlipped(false);
                setCurrentIndex((prev) => (prev + 1) % deck.length);
            };

            const handlePrev = () => {
                setIsFlipped(false);
                setCurrentIndex((prev) => (prev - 1 + deck.length) % deck.length);
            };

            const handleKnewIt = () => {
                updateProgress(currentWord.chinese, Math.min(5, (progress[currentWord.chinese] || 0) + 1));
                handleNext();
            };

            const handleAgain = () => {
                updateProgress(currentWord.chinese, Math.max(0, (progress[currentWord.chinese] || 0) - 1));
                handleNext();
            };

            const speakWord = (lang = 'zh-CN') => {
                const utterance = new SpeechSynthesisUtterance(
                    lang === 'zh-CN' ? currentWord.chinese : currentWord.english
                );
                utterance.lang = lang;
                window.speechSynthesis.speak(utterance);
            };

            return (
                <div className="bg-white rounded-xl shadow-lg p-6 max-w-2xl mx-auto">
                    <div className="text-center mb-4">
                        <span className="text-sm text-green-600 font-medium">
                            Card {currentIndex + 1} of {deck.length}
                        </span>
                    </div>

                    {/* Flashcard */}
                    <div 
                        ref={cardRef}
                        className={`card mx-auto mb-6 cursor-pointer ${isFlipped ? 'flipped' : ''}`}
                        onClick={() => setIsFlipped(!isFlipped)}
                    >
                        <div className="card-inner">
                            {/* Front of card */}
                            <div className="card-front bg-green-100 border-2 border-green-300">
                                <div className="text-4xl font-bold mb-4">{currentWord.chinese}</div>
                                <div className="text-green-600">Click or press Space to flip</div>
                            </div>
                            
                            {/* Back of card */}
                            <div className="card-back bg-white border-2 border-green-300">
                                <div className="text-4xl font-bold mb-2">{currentWord.chinese}</div>
                                <div className="text-xl text-gray-700 mb-2">{currentWord.english}</div>
                                <div className="text-lg text-gray-600 mb-4">{currentWord.russian}</div>
                                <div className="text-green-600">Click or press Space to flip back</div>
                            </div>
                        </div>
                    </div>

                    {/* Controls */}
                    <div className="flex flex-wrap justify-center gap-4">
                        <button 
                            className="bg-green-500 hover:bg-green-600 text-white font-medium py-2 px-4 rounded-full flex items-center"
                            onClick={() => speakWord('zh-CN')}
                        >
                            <svg className="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15.536a5 5 0 001.414-1.414m-1.414-2.828a9 9 0 010-12.728"></path>
                            </svg>
                            Speak Chinese (V)
                        </button>
                        <button 
                            className="bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-full flex items-center"
                            onClick={() => speakWord('en-US')}
                        >
                            <svg className="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15.536a5 5 0 001.414-1.414m-1.414-2.828a9 9 0 010-12.728"></path>
                            </svg>
                            Speak English
                        </button>
                    </div>

                    <div className="flex flex-wrap justify-center gap-4 mt-4">
                        <button 
                            className="bg-red-500 hover:bg-red-600 text-white font-medium py-2 px-4 rounded-full"
                            onClick={handleAgain}
                        >
                            Again (A)
                        </button>
                        <button 
                            className="bg-yellow-500 hover:bg-yellow-600 text-white font-medium py-2 px-4 rounded-full"
                            onClick={handlePrev}
                        >
                            Previous
                        </button>
                        <button 
                            className="bg-green-500 hover:bg-green-600 text-white font-medium py-2 px-4 rounded-full"
                            onClick={handleKnewIt}
                        >
                            Knew It (K)
                        </button>
                        <button 
                            className="bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-full"
                            onClick={handleNext}
                        >
                            Next
                        </button>
                    </div>

                    <div className="mt-6 text-center text-sm text-gray-600">
                        <p>Space: Flip card | K: Knew It | A: Again | V: Speak Chinese</p>
                    </div>
                </div>
            );
        }

        // Quiz Component
        function Quiz({ deck, progress, updateProgress }) {
            const [currentIndex, setCurrentIndex] = useState(0);
            const [options, setOptions] = useState([]);
            const [selectedOption, setSelectedOption] = useState(null);
            const [showResult, setShowResult] = useState(false);
            const [score, setScore] = useState(0);

            // Initialize quiz
            useEffect(() => {
                if (deck.length > 0) {
                    generateOptions();
                }
            }, [currentIndex, deck]);

            const currentWord = deck[currentIndex];

            const generateOptions = () => {
                if (!currentWord) return;
                
                // Create options: correct answer + 3 random wrong answers
                const wrongAnswers = deck
                    .filter(word => word.chinese !== currentWord.chinese)
                    .sort(() => 0.5 - Math.random())
                    .slice(0, 3)
                    .map(word => word.chinese);
                
                const allOptions = [currentWord.chinese, ...wrongAnswers];
                setOptions(allOptions.sort(() => 0.5 - Math.random()));
            };

            const handleOptionSelect = (option) => {
                if (showResult) return;
                
                setSelectedOption(option);
                setShowResult(true);
                
                if (option === currentWord.chinese) {
                    setScore(prev => prev + 1);
                    updateProgress(currentWord.chinese, Math.min(5, (progress[currentWord.chinese] || 0) + 1));
                    
                    // Speak the word when correct
                    const utterance = new SpeechSynthesisUtterance(currentWord.chinese);
                    utterance.lang = 'zh-CN';
                    window.speechSynthesis.speak(utterance);
                } else {
                    updateProgress(currentWord.chinese, Math.max(0, (progress[currentWord.chinese] || 0) - 1));
                }
            };

            const handleNext = () => {
                setSelectedOption(null);
                setShowResult(false);
                setCurrentIndex((prev) => (prev + 1) % deck.length);
            };

            const resetQuiz = () => {
                setCurrentIndex(0);
                setSelectedOption(null);
                setShowResult(false);
                setScore(0);
            };

            return (
                <div className="bg-white rounded-xl shadow-lg p-6 max-w-2xl mx-auto">
                    <div className="text-center mb-6">
                        <h2 className="text-2xl font-bold text-green-800 mb-2">Multiple Choice Quiz</h2>
                        <div className="flex justify-between items-center">
                            <span className="text-sm text-green-600 font-medium">
                                Question {currentIndex + 1} of {deck.length}
                            </span>
                            <span className="text-sm text-green-600 font-medium">
                                Score: {score}/{currentIndex + 1}
                            </span>
                        </div>
                    </div>

                    {currentWord && (
                        <>
                            <div className="bg-green-50 rounded-lg p-6 mb-6 text-center">
                                <p className="text-xl font-medium text-gray-700 mb-4">{currentWord.english}</p>
                                <p className="text-lg text-gray-600">{currentWord.russian}</p>
                            </div>

                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                                {options.map((option, index) => (
                                    <button
                                        key={index}
                                        className={`p-4 rounded-lg text-lg font-medium transition-all ${
                                            !showResult 
                                                ? 'bg-green-100 hover:bg-green-200 text-green-800' 
                                                : option === currentWord.chinese 
                                                    ? 'bg-green-500 text-white' 
                                                    : option === selectedOption 
                                                        ? 'bg-red-500 text-white' 
                                                        : 'bg-green-100 text-green-800'
                                        }`}
                                        onClick={() => handleOptionSelect(option)}
                                        disabled={showResult}
                                    >
                                        {option}
                                    </button>
                                ))}
                            </div>

                            {showResult && (
                                <div className="text-center">
                                    {selectedOption === currentWord.chinese ? (
                                        <div className="text-green-600 font-bold text-xl mb-4">Correct! Well done!</div>
                                    ) : (
                                        <div className="text-red-600 font-bold text-xl mb-4">
                                            Incorrect. The answer is: {currentWord.chinese}
                                        </div>
                                    )}
                                    
                                    <button 
                                        className="bg-green-500 hover:bg-green-600 text-white font-medium py-2 px-6 rounded-full"
                                        onClick={handleNext}
                                    >
                                        {currentIndex + 1 === deck.length ? 'Finish Quiz' : 'Next Question'}
                                    </button>
                                </div>
                            )}

                            {currentIndex + 1 === deck.length && showResult && (
                                <div className="mt-6 text-center">
                                    <button 
                                        className="bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-6 rounded-full"
                                        onClick={resetQuiz}
                                    >
                                        Restart Quiz
                                    </button>
                                </div>
                            )}
                        </>
                    )}
                </div>
            );
        }

        // TypeIt Component
        function TypeIt({ deck, progress, updateProgress }) {
            const [currentIndex, setCurrentIndex] = useState(0);
            const [userInput, setUserInput] = useState('');
            const [showResult, setShowResult] = useState(false);
            const [isCorrect, setIsCorrect] = useState(false);
            const [score, setScore] = useState(0);
            const inputRef = useRef(null);

            const currentWord = deck[currentIndex];

            const handleCheck = () => {
                if (!userInput.trim()) return;
                
                const correct = userInput.trim() === currentWord.chinese;
                setIsCorrect(correct);
                setShowResult(true);
                
                if (correct) {
                    setScore(prev => prev + 1);
                    updateProgress(currentWord.chinese, Math.min(5, (progress[currentWord.chinese] || 0) + 1));
                    
                    // Speak the word when correct
                    const utterance = new SpeechSynthesisUtterance(currentWord.chinese);
                    utterance.lang = 'zh-CN';
                    window.speechSynthesis.speak(utterance);
                } else {
                    updateProgress(currentWord.chinese, Math.max(0, (progress[currentWord.chinese] || 0) - 1));
                }
            };

            const handleNext = () => {
                setUserInput('');
                setShowResult(false);
                setIsCorrect(false);
                setCurrentIndex((prev) => (prev + 1) % deck.length);
                
                // Focus on input for next word
                if (inputRef.current) {
                    inputRef.current.focus();
                }
            };

            const handleKeyDown = (e) => {
                if (e.key === 'Enter') {
                    if (showResult) {
                        handleNext();
                    } else {
                        handleCheck();
                    }
                }
            };

            const resetExercise = () => {
                setCurrentIndex(0);
                setUserInput('');
                setShowResult(false);
                setIsCorrect(false);
                setScore(0);
                
                if (inputRef.current) {
                    inputRef.current.focus();
                }
            };

            return (
                <div className="bg-white rounded-xl shadow-lg p-6 max-w-2xl mx-auto">
                    <div className="text-center mb-6">
                        <h2 className="text-2xl font-bold text-green-800 mb-2">Type It Exercise</h2>
                        <div className="flex justify-between items-center">
                            <span className="text-sm text-green-600 font-medium">
                                Word {currentIndex + 1} of {deck.length}
                            </span>
                            <span className="text-sm text-green-600 font-medium">
                                Score: {score}/{currentIndex + 1}
                            </span>
                        </div>
                    </div>

                    {currentWord && (
                        <>
                            <div className="bg-green-50 rounded-lg p-6 mb-6 text-center">
                                <p className="text-xl font-medium text-gray-700 mb-2">{currentWord.english}</p>
                                <p className="text-lg text-gray-600 mb-4">{currentWord.russian}</p>
                                
                                {!showResult ? (
                                    <div className="flex flex-col items-center">
                                        <input
                                            ref={inputRef}
                                            type="text"
                                            value={userInput}
                                            onChange={(e) => setUserInput(e.target.value)}
                                            onKeyDown={handleKeyDown}
                                            className="w-full max-w-md p-3 border-2 border-green-300 rounded-lg text-xl text-center focus:outline-none focus:border-green-500"
                                            placeholder="Type the Chinese characters"
                                            autoFocus
                                        />
                                        <button 
                                            className="mt-4 bg-green-500 hover:bg-green-600 text-white font-medium py-2 px-6 rounded-full"
                                            onClick={handleCheck}
                                        >
                                            Check Answer
                                        </button>
                                    </div>
                                ) : (
                                    <div className="text-center">
                                        {isCorrect ? (
                                            <div className="text-green-600 font-bold text-xl mb-2">Correct! Well done!</div>
                                        ) : (
                                            <div>
                                                <div className="text-red-600 font-bold text-xl mb-2">Incorrect</div>
                                                <div className="text-lg text-gray-700 mb-2">The correct answer is: <span className="font-bold">{currentWord.chinese}</span></div>
                                            </div>
                                        )}
                                        
                                        <button 
                                            className="mt-4 bg-green-500 hover:bg-green-600 text-white font-medium py-2 px-6 rounded-full"
                                            onClick={handleNext}
                                        >
                                            {currentIndex + 1 === deck.length ? 'Finish' : 'Next Word'}
                                        </button>
                                    </div>
                                )}
                            </div>

                            {currentIndex + 1 === deck.length && showResult && (
                                <div className="mt-6 text-center">
                                    <button 
                                        className="bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-6 rounded-full"
                                        onClick={resetExercise}
                                    >
                                        Restart Exercise
                                    </button>
                                </div>
                            )}
                        </>
                    )}
                </div>
            );
        }

        // MiniGame Component
        function MiniGame({ deck, progress, updateProgress }) {
            const [gameWords, setGameWords] = useState([]);
            const [matchedPairs, setMatchedPairs] = useState([]);
            const [selectedCard, setSelectedCard] = useState(null);
            const [moves, setMoves] = useState(0);
            const [gameCompleted, setGameCompleted] = useState(false);

            // Initialize game
            useEffect(() => {
                startNewGame();
            }, [deck]);

            const startNewGame = () => {
                // Select 8 random words for the game (4 pairs)
                const selectedWords = [...deck]
                    .sort(() => 0.5 - Math.random())
                    .slice(0, 4);
                
                // Create pairs: Chinese and English
                const wordPairs = [];
                selectedWords.forEach(word => {
                    wordPairs.push({
                        id: `${word.chinese}-chinese`,
                        content: word.chinese,
                        type: 'chinese',
                        word: word
                    });
                    wordPairs.push({
                        id: `${word.chinese}-english`,
                        content: word.english,
                        type: 'english',
                        word: word
                    });
                });
                
                // Shuffle the pairs
                setGameWords(wordPairs.sort(() => 0.5 - Math.random()));
                setMatchedPairs([]);
                setSelectedCard(null);
                setMoves(0);
                setGameCompleted(false);
            };

            const handleCardClick = (card) => {
                // If card is already matched or selected, do nothing
                if (matchedPairs.includes(card.id) || card === selectedCard) return;
                
                // If no card is selected, select this card
                if (!selectedCard) {
                    setSelectedCard(card);
                    return;
                }
                
                // If a card is already selected, check for match
                setMoves(prev => prev + 1);
                
                // Check if the two selected cards form a pair
                if (
                    (selectedCard.type === 'chinese' && card.type === 'english' && selectedCard.word.chinese === card.word.chinese) ||
                    (selectedCard.type === 'english' && card.type === 'chinese' && selectedCard.word.chinese === card.word.chinese)
                ) {
                    // It's a match!
                    const newMatchedPairs = [...matchedPairs, selectedCard.id, card.id];
                    setMatchedPairs(newMatchedPairs);
                    
                    // Update progress for the matched word
                    updateProgress(selectedCard.word.chinese, Math.min(5, (progress[selectedCard.word.chinese] || 0) + 1));
                    
                    // Speak the word
                    const utterance = new SpeechSynthesisUtterance(selectedCard.word.chinese);
                    utterance.lang = 'zh-CN';
                    window.speechSynthesis.speak(utterance);
                    
                    // Check if game is completed
                    if (newMatchedPairs.length === gameWords.length) {
                        setGameCompleted(true);
                    }
                }
                
                // Reset selected card after a short delay
                setTimeout(() => {
                    setSelectedCard(null);
                }, 1000);
            };

            return (
                <div className="bg-white rounded-xl shadow-lg p-6 max-w-4xl mx-auto">
                    <div className="text-center mb-6">
                        <h2 className="text-2xl font-bold text-green-800 mb-2">Matching Game</h2>
                        <p className="text-gray-600 mb-4">Match Chinese characters with their English translations</p>
                        <div className="flex justify-between items-center">
                            <span className="text-sm text-green-600 font-medium">
                                Moves: {moves}
                            </span>
                            <span className="text-sm text-green-600 font-medium">
                                Matched: {matchedPairs.length / 2} of 4
                            </span>
                        </div>
                    </div>

                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                        {gameWords.map(card => (
                            <div
                                key={card.id}
                                className={`h-24 flex items-center justify-center p-4 rounded-lg text-center cursor-pointer transition-all ${
                                    matchedPairs.includes(card.id)
                                        ? 'bg-green-500 text-white'
                                        : selectedCard === card
                                        ? 'bg-yellow-400 text-gray-800'
                                        : 'bg-green-100 text-green-800 hover:bg-green-200'
                                }`}
                                onClick={() => handleCardClick(card)}
                            >
                                <span className="font-medium">{card.content}</span>
                            </div>
                        ))}
                    </div>

                    {gameCompleted && (
                        <div className="text-center bg-green-50 rounded-lg p-6">
                            <div className="text-green-600 font-bold text-2xl mb-4">Congratulations! You completed the game!</div>
                            <p className="text-gray-700 mb-4">You matched all pairs in {moves} moves.</p>
                            <button 
                                className="bg-green-500 hover:bg-green-600 text-white font-medium py-2 px-6 rounded-full"
                                onClick={startNewGame}
                            >
                                Play Again
                            </button>
                        </div>
                    )}

                    <div className="text-center mt-6">
                        <button 
                            className="bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-6 rounded-full"
                            onClick={startNewGame}
                        >
                            New Game
                        </button>
                    </div>
                </div>
            );
        }

        // Render the app
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
