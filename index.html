<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chinese Character Learning</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/17.0.2/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/17.0.2/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.26.0/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap');
        
        body {
            font-family: 'Noto Sans SC', sans-serif;
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
        }
        
        .card {
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        
        .card.flipped {
            transform: rotateY(180deg);
        }
        
        .card-front, .card-back {
            backface-visibility: hidden;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .card-back {
            transform: rotateY(180deg);
        }
        
        .word-card {
            transition: all 0.3s ease;
        }
        
        .word-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        
        .game-tile {
            transition: all 0.3s ease;
        }
        
        .game-tile:hover {
            transform: scale(1.05);
        }
        
        .pulse-success {
            animation: pulseSuccess 0.5s;
        }
        
        @keyframes pulseSuccess {
            0% { box-shadow: 0 0 0 0 rgba(72, 187, 120, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(72, 187, 120, 0); }
            100% { box-shadow: 0 0 0 0 rgba(72, 187, 120, 0); }
        }
        
        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid #16a34a;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="min-h-screen">
    <div id="root">
        <div class="flex flex-col justify-center items-center h-screen bg-green-50 p-4">
            <div class="text-center max-w-md">
                <h1 class="text-3xl font-bold text-green-800 mb-4">Chinese Character Learning</h1>
                <div class="loading-spinner mb-4"></div>
                <p class="text-gray-600 mb-2">Loading application...</p>
                <p class="text-sm text-gray-500">If this takes too long, check your internet connection.</p>
            </div>
        </div>
    </div>

    <script type="text/babel">
        // 检查React是否加载成功
        if (typeof React === 'undefined') {
            document.getElementById('root').innerHTML = `
                <div class="flex justify-center items-center h-screen bg-red-50">
                    <div class="text-center max-w-md p-8 bg-white rounded-xl shadow-lg">
                        <h1 class="text-2xl font-bold text-red-800 mb-4">加载错误</h1>
                        <p class="text-red-600 mb-4">无法加载React库。请检查网络连接后刷新页面。</p>
                        <button onclick="window.location.reload()" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors">
                            刷新页面
                        </button>
                    </div>
                </div>
            `;
            throw new Error("React not loaded");
        }

        const { useState, useEffect, useRef } = React;

        // 词汇数据
        const wordData = {
            'L1': [
                { chinese: '一个', english: 'one/a', russian: 'один/одна' },
                { chinese: '一天', english: 'one day', russian: 'один день' },
                { chinese: '二十', english: 'twenty', russian: 'двадцать' },
                { chinese: '十二', english: 'twelve', russian: 'двенадцать' },
                { chinese: '三十', english: 'thirty', russian: 'тридцать' },
                { chinese: '十三', english: 'thirteen', russian: 'тринадцать' },
                { chinese: '十一', english: 'eleven', russian: 'одиннадцать' },
                { chinese: '三十二', english: 'thirty-two', russian: 'тридцать два' },
                { chinese: '上午', english: 'morning', russian: 'утро' },
                { chinese: '上课', english: 'attend class', russian: 'посещать занятия' },
                { chinese: '一千', english: 'one thousand', russian: 'одна тысяча' },
                { chinese: '三千', english: 'three thousand', russian: 'три тысячи' },
                { chinese: '下午', english: 'afternoon', russian: 'после полудня' },
                { chinese: '学生', english: 'student', russian: 'студент' },
                { chinese: '一个学生', english: 'one student', russian: 'один студент' },
                { chinese: '十八', english: 'eighteen', russian: 'восемнадцать' },
                { chinese: '八十', english: 'eighty', russian: 'восемьдесят' },
                { chinese: '一个人', english: 'one person', russian: 'один человек' },
                { chinese: '中国人', english: 'Chinese person', russian: 'китаец' },
                { chinese: '八个学生', english: 'eight students', russian: 'восемь студентов' },
                { chinese: '三个中国人', english: 'three Chinese people', russian: 'три китайца' },
                { chinese: '今天', english: 'today', russian: 'сегодня' },
                { chinese: '明天', english: 'tomorrow', russian: 'завтра' },
                { chinese: '下课', english: 'finish class', russian: 'закончить занятия' },
                { chinese: '六十', english: 'sixty', russian: 'шестьдесят' },
                { chinese: '六千', english: 'six thousand', russian: 'шесть тысяч' },
                { chinese: '学习', english: 'study', russian: 'учиться' }
            ],
            'L2': [
                { chinese: '工人', english: 'worker', russian: 'рабочий' },
                { chinese: '工作', english: 'work', russian: 'работа' },
                { chinese: '干什么', english: 'what to do', russian: 'что делать' },
                { chinese: '土豆', english: 'potato', russian: 'картофель' },
                { chinese: '王老师', english: 'Teacher Wang', russian: 'Учитель Ван' },
                { chinese: '我姓王', english: 'My surname is Wang', russian: 'Моя фамилия Ван' },
                { chinese: '牛奶', english: 'milk', russian: 'молоко' },
                { chinese: '牛肉', english: 'beef', russian: 'говядина' },
                { chinese: '工厂', english: 'factory', russian: 'фабрика' },
                { chinese: '广告', english: 'advertisement', russian: 'реклама' },
                { chinese: '大学', english: 'university', russian: 'университет' },
                { chinese: '太好了', english: 'great', russian: 'отлично' },
                { chinese: '开门', english: 'open the door', russian: 'открыть дверь' },
                { chinese: '开始', english: 'start', russian: 'начать' },
                { chinese: '关门', english: 'close the door', russian: 'закрыть дверь' },
                { chinese: '木门', english: 'wooden door', russian: 'деревянная дверь' },
                { chinese: '本子', english: 'notebook', russian: 'тетрадь' },
                { chinese: '一本书', english: 'a book', russian: 'одна книга' },
                { chinese: '不是', english: 'is not', russian: 'не является' },
                { chinese: '不好', english: 'not good', russian: 'не хорошо' },
                { chinese: '中文', english: 'Chinese language', russian: 'китайский язык' },
                { chinese: '英文', english: 'English language', russian: 'английский язык' },
                { chinese: '多少', english: 'how much/many', russian: 'сколько' },
                { chinese: '很少', english: 'very few', russian: 'очень мало' },
                { chinese: '来中国', english: 'come to China', russian: 'приехать в Китай' },
                { chinese: '来北京', english: 'come to Beijing', russian: 'приехать в Пекин' },
                { chinese: '走路', english: 'walk', russian: 'ходить пешком' },
                { chinese: '作业', english: 'homework', russian: 'домашнее задание' },
                { chinese: '火车', english: 'train', russian: 'поезд' },
                { chinese: '一斤', english: 'one jin (500g)', russian: 'один цзинь (500г)' },
                { chinese: '八斤', english: 'eight jin', russian: 'восемь цзиней' },
                { chinese: '今年', english: 'this year', russian: 'в этом году' },
                { chinese: '明年', english: 'next year', russian: 'в следующем году' },
                { chinese: '头发', english: 'hair', russian: 'волосы' },
                { chinese: '电话卡', english: 'phone card', russian: 'телефонная карта' },
                { chinese: '一张卡', english: 'one card', russian: 'одна карта' },
                { chinese: '一共', english: 'altogether', russian: 'всего' }
            ]
        };

        // 语音合成功能
        const speakText = (text, lang = 'zh-CN') => {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = lang;
                utterance.rate = 0.8;
                window.speechSynthesis.speak(utterance);
            }
        };

        // 主应用组件
        function App() {
            const [mode, setMode] = useState('flashcard');
            const [currentDeck, setCurrentDeck] = useState('L1');
            const [progress, setProgress] = useState({});
            
            // 从localStorage加载进度
            useEffect(() => {
                try {
                    const savedProgress = localStorage.getItem('chineseLearningProgress');
                    if (savedProgress) {
                        setProgress(JSON.parse(savedProgress));
                    }
                } catch (error) {
                    console.error("Error loading progress:", error);
                }
            }, []);
            
            // 保存进度到localStorage
            useEffect(() => {
                try {
                    localStorage.setItem('chineseLearningProgress', JSON.stringify(progress));
                } catch (error) {
                    console.error("Error saving progress:", error);
                }
            }, [progress]);
            
            // 更新单词进度
            const updateProgress = (word, mastery) => {
                setProgress(prev => ({
                    ...prev,
                    [word]: mastery
                }));
            };
            
            // 重置进度
            const resetProgress = () => {
                if (window.confirm('确定要重置所有学习进度吗？此操作不可撤销。')) {
                    setProgress({});
                }
            };
            
            // 计算统计信息
            const stats = {
                total: wordData[currentDeck].length,
                mastered: Object.values(progress).filter(level => level >= 4).length,
                learning: Object.values(progress).filter(level => level > 0 && level < 4).length,
                new: Object.values(progress).filter(level => level === 0 || !level).length
            };
            
            return (
                <div className="min-h-screen">
                    {/* 顶部导航 */}
                    <header className="bg-green-600 text-white p-4 shadow-md">
                        <div className="container mx-auto flex flex-col md:flex-row justify-between items-center">
                            <h1 className="text-2xl font-bold mb-2 md:mb-0">汉语词汇学习</h1>
                            <div className="flex items-center space-x-4">
                                <div className="flex items-center">
                                    <span className="mr-2">词库:</span>
                                    <select 
                                        value={currentDeck} 
                                        onChange={(e) => setCurrentDeck(e.target.value)}
                                        className="bg-green-700 text-white px-2 py-1 rounded"
                                    >
                                        <option value="L1">L1 基础词汇</option>
                                        <option value="L2">L2 扩展词汇</option>
                                    </select>
                                </div>
                                
                                <div className="flex items-center">
                                    <div className="mr-4 text-center">
                                        <div className="text-lg font-bold">{stats.mastered}/{stats.total}</div>
                                        <div className="text-xs">已掌握</div>
                                    </div>
                                    <div className="w-24 bg-green-200 rounded-full h-2.5">
                                        <div 
                                            className="bg-green-700 h-2.5 rounded-full transition-all duration-500" 
                                            style={{ width: `${Math.round((stats.mastered / stats.total) * 100)}%` }}
                                        ></div>
                                    </div>
                                    <span className="ml-2 text-sm">{Math.round((stats.mastered / stats.total) * 100)}%</span>
                                </div>
                            </div>
                        </div>
                    </header>
                    
                    {/* 模式选择 */}
                    <nav className="bg-white shadow-sm py-3">
                        <div className="container mx-auto flex flex-wrap justify-center">
                            <button
                                onClick={() => setMode('flashcard')}
                                className={`mx-2 my-1 px-4 py-2 rounded-lg transition-colors ${
                                    mode === 'flashcard' 
                                        ? 'bg-green-600 text-white' 
                                        : 'bg-green-100 text-green-800 hover:bg-green-200'
                                }`}
                            >
                                单词卡
                            </button>
                            <button
                                onClick={() => setMode('quiz')}
                                className={`mx-2 my-1 px-4 py-2 rounded-lg transition-colors ${
                                    mode === 'quiz' 
                                        ? 'bg-green-600 text-white' 
                                        : 'bg-green-100 text-green-800 hover:bg-green-200'
                                }`}
                            >
                                选择题
                            </button>
                            <button
                                onClick={() => setMode('typeit')}
                                className={`mx-2 my-1 px-4 py-2 rounded-lg transition-colors ${
                                    mode === 'typeit' 
                                        ? 'bg-green-600 text-white' 
                                        : 'bg-green-100 text-green-800 hover:bg-green-200'
                                }`}
                            >
                                打字练习
                            </button>
                            <button
                                onClick={() => setMode('minigame')}
                                className={`mx-2 my-1 px-4 py-2 rounded-lg transition-colors ${
                                    mode === 'minigame' 
                                        ? 'bg-green-600 text-white' 
                                        : 'bg-green-100 text-green-800 hover:bg-green-200'
                                }`}
                            >
                                配对游戏
                            </button>
                            <button
                                onClick={() => setMode('wordlist')}
                                className={`mx-2 my-1 px-4 py-2 rounded-lg transition-colors ${
                                    mode === 'wordlist' 
                                        ? 'bg-green-600 text-white' 
                                        : 'bg-green-100 text-green-800 hover:bg-green-200'
                                }`}
                            >
                                词汇表
                            </button>
                        </div>
                    </nav>
                    
                    {/* 主要内容区域 */}
                    <main className="container mx-auto p-4">
                        {mode === 'flashcard' && (
                            <FlashcardMode 
                                deck={wordData[currentDeck]} 
                                progress={progress} 
                                updateProgress={updateProgress} 
                            />
                        )}
                        
                        {mode === 'quiz' && (
                            <QuizMode 
                                deck={wordData[currentDeck]} 
                                progress={progress} 
                                updateProgress={updateProgress} 
                            />
                        )}
                        
                        {mode === 'typeit' && (
                            <TypeItMode 
                                deck={wordData[currentDeck]} 
                                progress={progress} 
                                updateProgress={updateProgress} 
                            />
                        )}
                        
                        {mode === 'minigame' && (
                            <MiniGameMode 
                                deck={wordData[currentDeck]} 
                                progress={progress} 
                                updateProgress={updateProgress} 
                            />
                        )}
                        
                        {mode === 'wordlist' && (
                            <WordListMode 
                                deck={wordData[currentDeck]} 
                                progress={progress} 
                            />
                        )}
                    </main>
                    
                    {/* 页脚 */}
                    <footer className="bg-green-800 text-white p-4 mt-8">
                        <div className="container mx-auto flex flex-col md:flex-row justify-between items-center">
                            <p>汉语学习应用 &copy; {new Date().getFullYear()}</p>
                            <button 
                                onClick={resetProgress}
                                className="mt-2 md:mt-0 px-4 py-2 bg-red-500 hover:bg-red-600 rounded-lg transition-colors"
                            >
                                重置进度
                            </button>
                        </div>
                    </footer>
                </div>
            );
        }

        // 单词卡模式组件
        function FlashcardMode({ deck, progress, updateProgress }) {
            const [currentIndex, setCurrentIndex] = useState(0);
            const [isFlipped, setIsFlipped] = useState(false);
            
            // 键盘快捷键
            useEffect(() => {
                const handleKeyDown = (e) => {
                    if (e.code === 'Space') {
                        e.preventDefault();
                        setIsFlipped(!isFlipped);
                    } else if (e.code === 'KeyK' && isFlipped) {
                        // 认识
                        updateProgress(deck[currentIndex].chinese, Math.min(5, (progress[deck[currentIndex].chinese] || 0) + 1));
                        nextCard();
                    } else if (e.code === 'KeyA' && isFlipped) {
                        // 不认识
                        updateProgress(deck[currentIndex].chinese, Math.max(0, (progress[deck[currentIndex].chinese] || 0) - 1));
                        nextCard();
                    } else if (e.code === 'KeyV') {
                        // 发音
                        if (isFlipped) {
                            speakText(deck[currentIndex].english, 'en-US');
                        } else {
                            speakText(deck[currentIndex].chinese);
                        }
                    }
                };
                
                window.addEventListener('keydown', handleKeyDown);
                return () => window.removeEventListener('keydown', handleKeyDown);
            }, [currentIndex, isFlipped, deck, progress, updateProgress]);
            
            const nextCard = () => {
                setIsFlipped(false);
                setCurrentIndex((prevIndex) => (prevIndex + 1) % deck.length);
            };
            
            const prevCard = () => {
                setIsFlipped(false);
                setCurrentIndex((prevIndex) => (prevIndex - 1 + deck.length) % deck.length);
            };
            
            const masteryLevel = progress[deck[currentIndex]?.chinese] || 0;
            
            return (
                <div className="max-w-2xl mx-auto">
                    <div className="mb-4 flex justify-between items-center">
                        <button 
                            onClick={prevCard}
                            className="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors"
                        >
                            上一个
                        </button>
                        <div className="text-center">
                            <span className="font-bold">{currentIndex + 1}</span> / {deck.length}
                            <div className="flex justify-center mt-1">
                                {[1, 2, 3, 4, 5].map((level) => (
                                    <div 
                                        key={level}
                                        className={`w-4 h-4 mx-1 rounded-full ${
                                            level <= masteryLevel ? 'bg-green-500' : 'bg-gray-300'
                                        }`}
                                    ></div>
                                ))}
                            </div>
                        </div>
                        <button 
                            onClick={nextCard}
                            className="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors"
                        >
                            下一个
                        </button>
                    </div>
                    
                    <div 
                        className={`card relative w-full h-64 cursor-pointer ${isFlipped ? 'flipped' : ''}`}
                        onClick={() => setIsFlipped(!isFlipped)}
                    >
                        <div className="card-front bg-white rounded-xl shadow-lg flex flex-col justify-center items-center p-6">
                            <div className="text-4xl font-bold text-green-800 mb-4">
                                {deck[currentIndex]?.chinese}
                            </div>
                            <button 
                                onClick={(e) => {
                                    e.stopPropagation();
                                    speakText(deck[currentIndex].chinese);
                                }}
                                className="px-4 py-2 bg-green-100 text-green-800 rounded-lg hover:bg-green-200 transition-colors"
                            >
                                🔊 发音
                            </button>
                            <div className="mt-4 text-sm text-gray-500">
                                点击或按空格键翻转
                            </div>
                        </div>
                        
                        <div className="card-back bg-green-100 rounded-xl shadow-lg flex flex-col justify-center items-center p-6">
                            <div className="text-2xl font-bold text-green-800 mb-2">
                                {deck[currentIndex]?.english}
                            </div>
                            <div className="text-lg text-gray-700 mb-4">
                                {deck[currentIndex]?.russian}
                            </div>
                            <div className="flex space-x-2">
                                <button 
                                    onClick={(e) => {
                                        e.stopPropagation();
                                        speakText(deck[currentIndex].english, 'en-US');
                                    }}
                                    className="px-3 py-1 bg-white text-green-800 rounded-lg hover:bg-green-200 transition-colors"
                                >
                                    🔊 英文
                                </button>
                                <button 
                                    onClick={(e) => {
                                        e.stopPropagation();
                                        updateProgress(deck[currentIndex].chinese, Math.min(5, (progress[deck[currentIndex].chinese] || 0) + 1));
                                        nextCard();
                                    }}
                                    className="px-3 py-1 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors"
                                >
                                    认识 (K)
                                </button>
                                <button 
                                    onClick={(e) => {
                                        e.stopPropagation();
                                        updateProgress(deck[currentIndex].chinese, Math.max(0, (progress[deck[currentIndex].chinese] || 0) - 1));
                                        nextCard();
                                    }}
                                    className="px-3 py-1 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 transition-colors"
                                >
                                    不认识 (A)
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div className="mt-6 text-center text-sm text-gray-600">
                        <p>键盘快捷键: 空格 = 翻转, K = 认识, A = 不认识, V = 发音</p>
                    </div>
                </div>
            );
        }

        // 选择题模式组件
        function QuizMode({ deck, progress, updateProgress }) {
            const [currentIndex, setCurrentIndex] = useState(0);
            const [options, setOptions] = useState([]);
            const [selectedOption, setSelectedOption] = useState(null);
            const [showResult, setShowResult] = useState(false);
            const [score, setScore] = useState(0);
            
            // 初始化测验
            useEffect(() => {
                if (deck.length > 0) {
                    generateOptions(currentIndex);
                }
            }, [deck, currentIndex]);
            
            const generateOptions = (index) => {
                if (deck.length < 4) return;
                
                const correctAnswer = deck[index].chinese;
                const wrongAnswers = deck
                    .filter((_, i) => i !== index)
                    .sort(() => 0.5 - Math.random())
                    .slice(0, 3)
                    .map(item => item.chinese);
                
                const allOptions = [correctAnswer, ...wrongAnswers].sort(() => 0.5 - Math.random());
                setOptions(allOptions);
            };
            
            const handleAnswer = (option) => {
                if (showResult) return;
                
                setSelectedOption(option);
                setShowResult(true);
                
                const isCorrect = option === deck[currentIndex].chinese;
                if (isCorrect) {
                    setScore(score + 1);
                    updateProgress(deck[currentIndex].chinese, Math.min(5, (progress[deck[currentIndex].chinese] || 0) + 1));
                } else {
                    updateProgress(deck[currentIndex].chinese, Math.max(0, (progress[deck[currentIndex].chinese] || 0) - 1));
                }
                
                // 1.5秒后自动进入下一题
                setTimeout(() => {
                    nextQuestion();
                }, 1500);
            };
            
            const nextQuestion = () => {
                setSelectedOption(null);
                setShowResult(false);
                setCurrentIndex((prevIndex) => (prevIndex + 1) % deck.length);
            };
            
            if (deck.length < 4) {
                return (
                    <div className="text-center p-8 bg-white rounded-xl shadow-lg">
                        <p className="text-lg">此词库中的单词不足，无法进行测验。至少需要4个单词。</p>
                    </div>
                );
            }
            
            return (
                <div className="max-w-2xl mx-auto">
                    <div className="mb-6 text-center">
                        <h2 className="text-2xl font-bold text-green-800 mb-2">选择题测验</h2>
                        <div className="flex justify-between items-center bg-white p-4 rounded-lg shadow">
                            <div>
                                题目: <span className="font-bold">{currentIndex + 1}</span> / {deck.length}
                            </div>
                            <div>
                                得分: <span className="font-bold">{score}</span> / {deck.length}
                            </div>
                        </div>
                    </div>
                    
                    <div className="bg-white rounded-xl shadow-lg p-6 mb-6">
                        <div className="text-center mb-6">
                            <div className="text-lg text-gray-700 mb-2">
                                以下英文对应的中文是:
                            </div>
                            <div className="text-2xl font-bold text-green-800">
                                {deck[currentIndex]?.english}
                            </div>
                            <div className="text-lg text-gray-600 mt-1">
                                {deck[currentIndex]?.russian}
                            </div>
                        </div>
                        
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            {options.map((option, index) => {
                                const isCorrect = option === deck[currentIndex].chinese;
                                const isSelected = selectedOption === option;
                                let buttonClass = "p-4 text-lg rounded-lg transition-colors ";
                                
                                if (showResult) {
                                    if (isCorrect) {
                                        buttonClass += "bg-green-500 text-white pulse-success";
                                    } else if (isSelected) {
                                        buttonClass += "bg-red-500 text-white";
                                    } else {
                                        buttonClass += "bg-gray-200 text-gray-700";
                                    }
                                } else {
                                    buttonClass += "bg-green-100 text-green-800 hover:bg-green-200";
                                }
                                
                                return (
                                    <button
                                        key={index}
                                        className={buttonClass}
                                        onClick={() => handleAnswer(option)}
                                        disabled={showResult}
                                    >
                                        {option}
                                    </button>
                                );
                            })}
                        </div>
                    </div>
                    
                    {showResult && (
                        <div className="text-center">
                            <button 
                                onClick={nextQuestion}
                                className="px-6 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors"
                            >
                                下一题
                            </button>
                        </div>
                    )}
                </div>
            );
        }

        // 打字练习模式组件
        function TypeItMode({ deck, progress, updateProgress }) {
            const [currentIndex, setCurrentIndex] = useState(0);
            const [userInput, setUserInput] = useState('');
            const [showResult, setShowResult] = useState(false);
            const [isCorrect, setIsCorrect] = useState(false);
            const inputRef = useRef(null);
            
            useEffect(() => {
                if (inputRef.current) {
                    inputRef.current.focus();
                }
            }, [currentIndex]);
            
            const checkAnswer = () => {
                if (userInput.trim() === '') return;
                
                const correct = userInput.trim() === deck[currentIndex].chinese;
                setIsCorrect(correct);
                setShowResult(true);
                
                if (correct) {
                    updateProgress(deck[currentIndex].chinese, Math.min(5, (progress[deck[currentIndex].chinese] || 0) + 1));
                } else {
                    updateProgress(deck[currentIndex].chinese, Math.max(0, (progress[deck[currentIndex].chinese] || 0) - 1));
                }
            };
            
            const nextWord = () => {
                setUserInput('');
                setShowResult(false);
                setCurrentIndex((prevIndex) => (prevIndex + 1) % deck.length);
            };
            
            const handleKeyPress = (e) => {
                if (e.key === 'Enter') {
                    if (showResult) {
                        nextWord();
                    } else {
                        checkAnswer();
                    }
                }
            };
            
            return (
                <div className="max-w-2xl mx-auto">
                    <div className="mb-6 text-center">
                        <h2 className="text-2xl font-bold text-green-800 mb-2">打字练习</h2>
                        <div className="bg-white p-4 rounded-lg shadow inline-block">
                            题目: <span className="font-bold">{currentIndex + 1}</span> / {deck.length}
                        </div>
                    </div>
                    
                    <div className="bg-white rounded-xl shadow-lg p-6 mb-6">
                        <div className="text-center mb-6">
                            <div className="text-lg text-gray-700 mb-2">
                                输入以下内容的中文:
                            </div>
                            <div className="text-2xl font-bold text-green-800">
                                {deck[currentIndex]?.english}
                            </div>
                            <div className="text-lg text-gray-600 mt-1">
                                {deck[currentIndex]?.russian}
                            </div>
                        </div>
                        
                        <div className="flex flex-col items-center">
                            <input
                                ref={inputRef}
                                type="text"
                                value={userInput}
                                onChange={(e) => setUserInput(e.target.value)}
                                onKeyPress={handleKeyPress}
                                className="w-full max-w-md p-4 text-xl border-2 border-green-300 rounded-lg focus:outline-none focus:border-green-500 text-center"
                                placeholder="在此输入中文..."
                                disabled={showResult}
                            />
                            
                            {showResult && (
                                <div className={`mt-4 p-4 rounded-lg ${isCorrect ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`}>
                                    {isCorrect ? (
                                        <div className="text-center">
                                            <div className="text-2xl font-bold">正确!</div>
                                            <div className="text-lg mt-2">{deck[currentIndex]?.chinese}</div>
                                        </div>
                                    ) : (
                                        <div className="text-center">
                                            <div className="text-xl font-bold">错误</div>
                                            <div className="mt-2">
                                                正确答案: <span className="font-bold text-lg">{deck[currentIndex]?.chinese}</span>
                                            </div>
                                            <div className="mt-2">你的答案: {userInput}</div>
                                        </div>
                                    )}
                                </div>
                            )}
                        </div>
                    </div>
                    
                    <div className="text-center">
                        {!showResult ? (
                            <button 
                                onClick={checkAnswer}
                                className="px-6 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors"
                            >
                                检查答案
                            </button>
                        ) : (
                            <button 
                                onClick={nextWord}
                                className="px-6 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors"
                            >
                                下一个单词
                            </button>
                        )}
                    </div>
                    
                    <div className="mt-6 text-center text-sm text-gray-600">
                        <p>按Enter键检查答案或进入下一个单词</p>
                    </div>
                </div>
            );
        }

        // 配对游戏模式组件
        function MiniGameMode({ deck, progress, updateProgress }) {
            const [gameState, setGameState] = useState('setup');
            const [pairs, setPairs] = useState([]);
            const [selectedTile, setSelectedTile] = useState(null);
            const [matchedPairs, setMatchedPairs] = useState([]);
            const [moves, setMoves] = useState(0);
            
            // 初始化游戏
            useEffect(() => {
                if (gameState === 'setup' && deck.length >= 4) {
                    startGame();
                }
            }, [deck, gameState]);
            
            const startGame = () => {
                // 选择8个随机单词（4对）
                const selectedWords = [...deck]
                    .sort(() => 0.5 - Math.random())
                    .slice(0, 4);
                
                // 创建配对：中文和英文
                const newPairs = [];
                selectedWords.forEach(word => {
                    newPairs.push(
                        { id: `${word.chinese}-ch`, content: word.chinese, type: 'chinese', pairId: word.chinese },
                        { id: `${word.chinese}-en`, content: word.english, type: 'english', pairId: word.chinese }
                    );
                });
                
                // 洗牌
                setPairs(newPairs.sort(() => 0.5 - Math.random()));
                setMatchedPairs([]);
                setMoves(0);
                setGameState('playing');
            };
            
            const handleTileClick = (tile) => {
                if (selectedTile === tile || matchedPairs.includes(tile.pairId)) {
                    return;
                }
                
                if (!selectedTile) {
                    setSelectedTile(tile);
                    return;
                }
                
                setMoves(moves + 1);
                
                // 检查是否匹配
                if (selectedTile.pairId === tile.pairId) {
                    // 匹配成功
                    setMatchedPairs([...matchedPairs, tile.pairId]);
                    setSelectedTile(null);
                    
                    // 更新进度
                    updateProgress(tile.pairId, Math.min(5, (progress[tile.pairId] || 0) + 1));
                    
                    // 发音
                    speakText(tile.pairId);
                    
                    // 检查游戏是否完成
                    if (matchedPairs.length + 1 === 4) {
                        setTimeout(() => {
                            setGameState('result');
                        }, 1000);
                    }
                } else {
                    // 不匹配
                    setTimeout(() => {
                        setSelectedTile(null);
                    }, 1000);
                }
            };
            
            if (deck.length < 4) {
                return (
                    <div className="text-center p-8 bg-white rounded-xl shadow-lg">
                        <p className="text-lg">此词库中的单词不足，无法进行游戏。至少需要4个单词。</p>
                    </div>
                );
            }
            
            return (
                <div className="max-w-4xl mx-auto">
                    <div className="mb-6 text-center">
                        <h2 className="text-2xl font-bold text-green-800 mb-2">配对游戏</h2>
                        <p className="text-gray-700">将中文词汇与对应的英文翻译配对</p>
                        
                        {gameState === 'playing' && (
                            <div className="mt-4 bg-white p-4 rounded-lg shadow inline-block">
                                移动次数: <span className="font-bold">{moves}</span> | 
                                已匹配: <span className="font-bold">{matchedPairs.length}</span> / 4
                            </div>
                        )}
                    </div>
                    
                    {gameState === 'setup' && (
                        <div className="text-center">
                            <button 
                                onClick={startGame}
                                className="px-6 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors text-xl"
                            >
                                开始游戏
                            </button>
                        </div>
                    )}
                    
                    {gameState === 'playing' && (
                        <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                            {pairs.map(tile => {
                                const isSelected = selectedTile?.id === tile.id;
                                const isMatched = matchedPairs.includes(tile.pairId);
                                
                                let tileClass = "game-tile p-4 rounded-lg shadow-lg flex items-center justify-center text-center min-h-24 cursor-pointer transition-all ";
                                
                                if (isMatched) {
                                    tileClass += "bg-green-500 text-white transform scale-95";
                                } else if (isSelected) {
                                    tileClass += tile.type === 'chinese' 
                                        ? "bg-blue-500 text-white" 
                                        : "bg-yellow-500 text-white";
                                } else {
                                    tileClass += "bg-white text-gray-800 hover:bg-gray-100";
                                }
                                
                                return (
                                    <div
                                        key={tile.id}
                                        className={tileClass}
                                        onClick={() => handleTileClick(tile)}
                                    >
                                        <div className="font-bold text-lg">
                                            {tile.content}
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    )}
                    
                    {gameState === 'result' && (
                        <div className="text-center bg-white rounded-xl shadow-lg p-8">
                            <div className="text-3xl font-bold text-green-800 mb-4">游戏完成!</div>
                            <div className="text-xl mb-6">
                                你在 <span className="font-bold">{moves}</span> 次移动中匹配了所有单词!
                            </div>
                            <button 
                                onClick={() => setGameState('setup')}
                                className="px-6 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors text-xl"
                            >
                                再玩一次
                            </button>
                        </div>
                    )}
                </div>
            );
        }

        // 词汇表模式组件
        function WordListMode({ deck, progress }) {
            const [filter, setFilter] = useState('all');
            
            const filteredDeck = deck.filter(word => {
                const mastery = progress[word.chinese] || 0;
                
                if (filter === 'all') return true;
                if (filter === 'mastered') return mastery >= 4;
                if (filter === 'learning') return mastery > 0 && mastery < 4;
                if (filter === 'new') return mastery === 0;
                
                return true;
            });
            
            return (
                <div className="max-w-6xl mx-auto">
                    <div className="mb-6 flex flex-col md:flex-row justify-between items-center">
                        <h2 className="text-2xl font-bold text-green-800 mb-4 md:mb-0">词汇表</h2>
                        
                        <div className="flex space-x-2">
                            <button
                                onClick={() => setFilter('all')}
                                className={`px-3 py-1 rounded-lg transition-colors ${
                                    filter === 'all' 
                                        ? 'bg-green-600 text-white' 
                                        : 'bg-green-100 text-green-800 hover:bg-green-200'
                                }`}
                            >
                                全部单词
                            </button>
                            <button
                                onClick={() => setFilter('new')}
                                className={`px-3 py-1 rounded-lg transition-colors ${
                                    filter === 'new' 
                                        ? 'bg-green-600 text-white' 
                                        : 'bg-green-100 text-green-800 hover:bg-green-200'
                                }`}
                            >
                                新单词
                            </button>
                            <button
                                onClick={() => setFilter('learning')}
                                className={`px-3 py-1 rounded-lg transition-colors ${
                                    filter === 'learning' 
                                        ? 'bg-green-600 text-white' 
                                        : 'bg-green-100 text-green-800 hover:bg-green-200'
                                }`}
                            >
                                学习中
                            </button>
                            <button
                                onClick={() => setFilter('mastered')}
                                className={`px-3 py-1 rounded-lg transition-colors ${
                                    filter === 'mastered' 
                                        ? 'bg-green-600 text-white' 
                                        : 'bg-green-100 text-green-800 hover:bg-green-200'
                                }`}
                            >
                                已掌握
                            </button>
                        </div>
                    </div>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        {filteredDeck.map((word, index) => {
                            const mastery = progress[word.chinese] || 0;
                            
                            let bgColor = 'bg-white';
                            if (mastery >= 4) bgColor = 'bg-green-100';
                            else if (mastery > 0) bgColor = 'bg-yellow-100';
                            
                            return (
                                <div 
                                    key={index}
                                    className={`word-card ${bgColor} rounded-xl shadow p-4 flex flex-col`}
                                >
                                    <div className="flex justify-between items-start mb-2">
                                        <div 
                                            className="text-2xl font-bold text-green-800 cursor-pointer"
                                            onClick={() => speakText(word.chinese)}
                                        >
                                            {word.chinese}
                                        </div>
                                        <div className="flex">
                                            {[1, 2, 3, 4, 5].map(level => (
                                                <div 
                                                    key={level}
                                                    className={`w-3 h-3 mx-0.5 rounded-full ${
                                                        level <= mastery ? 'bg-green-500' : 'bg-gray-300'
                                                    }`}
                                                ></div>
                                            ))}
                                        </div>
                                    </div>
                                    
                                    <div className="text-lg text-gray-700 mb-1">
                                        {word.english}
                                    </div>
                                    
                                    <div className="text-gray-600">
                                        {word.russian}
                                    </div>
                                    
                                    <div className="mt-2 flex space-x-2">
                                        <button 
                                            onClick={() => speakText(word.chinese)}
                                            className="px-2 py-1 bg-green-200 text-green-800 rounded text-sm hover:bg-green-300 transition-colors"
                                        >
                                            🔊 中文
                                        </button>
                                        <button 
                                            onClick={() => speakText(word.english, 'en-US')}
                                            className="px-2 py-1 bg-blue-200 text-blue-800 rounded text-sm hover:bg-blue-300 transition-colors"
                                        >
                                            🔊 英文
                                        </button>
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                    
                    {filteredDeck.length === 0 && (
                        <div className="text-center p-8 bg-white rounded-xl shadow-lg">
                            <p className="text-lg">没有符合筛选条件的单词。</p>
                        </div>
                    )}
                </div>
            );
        }

        // 渲染应用
        try {
            ReactDOM.render(React.createElement(App), document.getElementById('root'));
        } catch (error) {
            console.error("Application error:", error);
            document.getElementById('root').innerHTML = `
                <div class="flex justify-center items-center h-screen bg-red-50">
                    <div class="text-center max-w-md p-8 bg-white rounded-xl shadow-lg">
                        <h1 class="text-2xl font-bold text-red-800 mb-4">应用程序错误</h1>
                        <p class="text-red-600 mb-4">${error.message}</p>
                        <p class="text-sm text-gray-500 mb-4">请检查控制台获取详细信息。</p>
                        <button onclick="window.location.reload()" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors">
                            刷新页面
                        </button>
                    </div>
                </div>
            `;
        }
    </script>
</body>
</html>
