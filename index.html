<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, maximum-scale=1"
  />
  <title>Experiencing Chinese Characters · L1 & L2 Trainer</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html, body { height: 100%; background:#f6fff8; }
    .btn { @apply px-3 py-2 rounded-xl shadow font-medium border; }
    .btn-primary { @apply bg-green-600 text-white hover:bg-green-700; }
    .btn-soft { @apply bg-white hover:bg-green-50; }
    .chip { @apply text-xs px-2 py-0.5 rounded-full border bg-white; }
    .kbd { @apply text-[10px] px-1.5 py-0.5 rounded border bg-white; }
    .card { @apply rounded-2xl shadow-lg bg-white; }
  </style>
</head>
<body class="text-gray-800">
  <div id="root"></div>

  <script type="text/babel">
/** =======================
 *  Utilities
 *  ======================= */
const speak = (text, lang='zh-CN') => {
  try {
    const u = new SpeechSynthesisUtterance(text);
    u.lang = lang;
    window.speechSynthesis.cancel();
    window.speechSynthesis.speak(u);
  } catch (e) { /* no-op */ }
};

const sample = (arr) => arr[Math.floor(Math.random() * arr.length)];
const shuffle = (arr) => [...arr].sort(() => Math.random() - 0.5);

/** =======================
 *  Data (L1 & L2 from screenshots)
 *  You can freely edit/extend this list.
 *  id must be unique; mastery saved by id.
 *  ======================= */
const L1 = [
  { id: "l1-一个", zh: "一个", en: "one; a/an", ru: "один; один (одно/одна)" },
  { id: "l1-一天", zh: "一天", en: "one day", ru: "один день" },
  { id: "l1-二十", zh: "二十", en: "twenty", ru: "двадцать" },
  { id: "l1-十二", zh: "十二", en: "twelve", ru: "двенадцать" },
  { id: "l1-三十", zh: "三十", en: "thirty", ru: "тридцать" },
  { id: "l1-十三", zh: "十三", en: "thirteen", ru: "тринадцать" },
  { id: "l1-十一", zh: "十一", en: "eleven", ru: "одиннадцать" },
  { id: "l1-三十二", zh: "三十二", en: "thirty-two", ru: "тридцать два" },
  { id: "l1-上午", zh: "上午", en: "morning (a.m.)", ru: "утро; до полудня" },
  { id: "l1-上课", zh: "上课", en: "have class; start class", ru: "идти на урок; начинать урок" },
  { id: "l1-一千", zh: "一千", en: "one thousand", ru: "тысяча" },
  { id: "l1-三千", zh: "三千", en: "three thousand", ru: "три тысячи" },
  { id: "l1-下午", zh: "下午", en: "afternoon (p.m.)", ru: "день; после полудня" },
  { id: "l1-学生", zh: "学生", en: "student", ru: "студент; ученик" },
  { id: "l1-一个学生", zh: "一个学生", en: "one student", ru: "один студент/ученик" },
  { id: "l1-十八", zh: "十八", en: "eighteen", ru: "восемнадцать" },
  { id: "l1-八十", zh: "八十", en: "eighty", ru: "восемьдесят" },
  { id: "l1-一个人", zh: "一个人", en: "one person; alone", ru: "один человек; в одиночку" },
  { id: "l1-中国人", zh: "中国人", en: "Chinese (person)", ru: "китаец/китаянка" },
  { id: "l1-八个学生", zh: "八个学生", en: "eight students", ru: "восемь студентов" },
  { id: "l1-三个中国人", zh: "三个中国人", en: "three Chinese people", ru: "трое китайцев" },
  { id: "l1-今天", zh: "今天", en: "today", ru: "сегодня" },
  { id: "l1-明天", zh: "明天", en: "tomorrow", ru: "завтра" },
  { id: "l1-下课", zh: "下课", en: "finish class", ru: "заканчивать урок" },
  { id: "l1-六十", zh: "六十", en: "sixty", ru: "шестьдесят" },
  { id: "l1-六千", zh: "六千", en: "six thousand", ru: "шесть тысяч" },
  { id: "l1-学习", zh: "学习", en: "study; learn", ru: "учиться; изучать" },
];

const L2 = [
  { id: "l2-工人", zh: "工人", en: "worker", ru: "рабочий" },
  { id: "l2-工作", zh: "工作", en: "work; job", ru: "работать; работа" },
  { id: "l2-干什么", zh: "干什么", en: "do what? what for?", ru: "что делать? зачем?" },
  { id: "l2-土豆", zh: "土豆", en: "potato", ru: "картофель" },
  { id: "l2-王老师", zh: "王老师", en: "Teacher Wang", ru: "учитель Ван" },
  { id: "l2-我姓王", zh: "我姓王", en: "My surname is Wang", ru: "Моя фамилия Ван" },
  { id: "l2-牛奶", zh: "牛奶", en: "milk", ru: "молоко" },
  { id: "l2-牛肉", zh: "牛肉", en: "beef", ru: "говядина" },
  { id: "l2-工厂", zh: "工厂", en: "factory", ru: "фабрика; завод" },
  { id: "l2-广告", zh: "广告", en: "advertisement", ru: "реклама" },
  { id: "l2-大学", zh: "大学", en: "university", ru: "университет" },
  { id: "l2-太好了", zh: "太好了", en: "Great! Awesome!", ru: "Здорово! Отлично!" },
  { id: "l2-开门", zh: "开门", en: "open the door", ru: "открывать дверь" },
  { id: "l2-开始", zh: "开始", en: "start; begin", ru: "начинать(ся)" },
  { id: "l2-关门", zh: "关门", en: "close the door", ru: "закрывать дверь" },
  { id: "l2-木门", zh: "木门", en: "wooden door", ru: "деревянная дверь" },
  { id: "l2-本子", zh: "本子", en: "notebook", ru: "тетрадь" },
  { id: "l2-一本书", zh: "一本书", en: "one book", ru: "одна книга" },
  { id: "l2-不是", zh: "不是", en: "to not be", ru: "не являться" },
  { id: "l2-不好", zh: "不好", en: "not good", ru: "плохо; не хороший" },
  { id: "l2-中文", zh: "中文", en: "Chinese (language)", ru: "китайский язык" },
  { id: "l2-英文", zh: "英文", en: "English (language)", ru: "английский язык" },
  { id: "l2-多少", zh: "多少", en: "how many/much", ru: "сколько" },
  { id: "l2-很少", zh: "很少", en: "very few; seldom", ru: "очень мало; редко" },
  { id: "l2-来中国", zh: "来中国", en: "come to China", ru: "приехать в Китай" },
  { id: "l2-来北京", zh: "来北京", en: "come to Beijing", ru: "приехать в Пекин" },
  { id: "l2-走路", zh: "走路", en: "walk; on foot", ru: "идти пешком" },
  { id: "l2-作业", zh: "作业", en: "homework", ru: "домашнее задание" },
  { id: "l2-火车", zh: "火车", en: "train", ru: "поезд" },
  { id: "l2-一斤", zh: "一斤", en: "one jin (≈500g)", ru: "один цзинь (≈500 г)" },
  { id: "l2-八斤", zh: "八斤", en: "eight jin (≈4 kg)", ru: "восемь цзиней (≈4 кг)" },
  { id: "l2-今年", zh: "今年", en: "this year", ru: "в этом году" },
  { id: "l2-明年", zh: "明年", en: "next year", ru: "в следующем году" },
  { id: "l2-头发", zh: "头发", en: "hair (on head)", ru: "волосы" },
  { id: "l2-电话卡", zh: "电话卡", en: "SIM/phone card", ru: "телефонная SIM-карта" },
  { id: "l2-一张卡", zh: "一张卡", en: "one card", ru: "одна карточка" },
  { id: "l2-一共", zh: "一共", en: "in total; altogether", ru: "всего; итого" },
];

const ALL = [...L1, ...L2];

/** =======================
 *  Persistence
 *  ======================= */
const STORAGE_KEY = "ecc-l1l2-progress-v1";
function loadProgress() {
  try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || {}; }
  catch { return {}; }
}
function saveProgress(data) {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
}

/** =======================
 *  Core Components
 *  ======================= */
function Header({deckName, mode, setMode, stats, onReset}) {
  return (
    <div className="sticky top-0 z-20 bg-[#f6fff8]/80 backdrop-blur border-b">
      <div className="max-w-6xl mx-auto px-4 py-3 flex items-center gap-3 justify-between">
        <div className="flex items-center gap-3">
          <div className="text-2xl font-semibold text-green-700">字感练习 · ECC</div>
          <span className="chip">Deck: {deckName}</span>
          <span className="chip">Mastered: {stats.mastered}/{stats.total} ({stats.percent}%)</span>
        </div>
        <div className="flex items-center gap-2">
          {["Flashcards","Quiz","Type-It","Mini-Game","List"].map(m=>(
            <button key={m}
                    className={"btn btn-soft "+(mode===m?"border-green-600":"")}
                    onClick={()=>setMode(m)}>{m}</button>
          ))}
          <button className="btn btn-soft" onClick={onReset}>Reset</button>
        </div>
      </div>
    </div>
  )
}

function DeckPicker({deck, setDeck}) {
  return (
    <div className="max-w-6xl mx-auto px-4 pt-4 pb-2">
      <div className="flex flex-wrap gap-2">
        <button
          className={"btn "+(deck==="ALL"?"btn-primary":"btn-soft")}
          onClick={()=>setDeck("ALL")}
        >L1 & L2（合并）</button>
        <button
          className={"btn "+(deck==="L1"?"btn-primary":"btn-soft")}
          onClick={()=>setDeck("L1")}
        >L1</button>
        <button
          className={"btn "+(deck==="L2"?"btn-primary":"btn-soft")}
          onClick={()=>setDeck("L2")}
        >L2</button>
      </div>
      <p className="text-xs text-gray-500 mt-2">
        Hotkeys in Flashcards: <span class="kbd">Space</span> flip,
        <span class="ml-1 kbd">K</span> knew,
        <span class="ml-1 kbd">A</span> again,
        <span class="ml-1 kbd">V</span> voice.
      </p>
    </div>
  )
}

/** ---------- Flashcards ---------- */
function Flashcards({items, progress, updateProgress}) {
  const [i, setI] = React.useState(0);
  const [showBack, setShowBack] = React.useState(false);

  const card = items[i];

  React.useEffect(()=>{
    const handler = (e)=>{
      if (e.target.tagName === "INPUT" || e.target.tagName === "TEXTAREA") return;
      if (e.code === "Space") { e.preventDefault(); setShowBack(s=>!s); }
      if (e.key.toLowerCase() === "k") knew();
      if (e.key.toLowerCase() === "a") again();
      if (e.key.toLowerCase() === "v") speakNow();
    };
    window.addEventListener("keydown", handler);
    return ()=>window.removeEventListener("keydown", handler);
  }, [i, showBack, items]);

  const next = () => {
    setShowBack(false);
    setI((i+1) % items.length);
  };
  const prev = () => {
    setShowBack(false);
    setI((i-1+items.length) % items.length);
  };

  const mastery = progress[card.id]?.m ?? 0;

  const knew = () => {
    const m = Math.min(5, mastery + 1);
    updateProgress(card.id, m);
    next();
  };
  const again = () => {
    const m = Math.max(0, mastery - 1);
    updateProgress(card.id, m);
  };
  const speakNow = () => speak(card.zh, 'zh-CN');

  return (
    <div className="max-w-4xl mx-auto p-4">
      <div className="flex items-center justify-between mb-3">
        <div className="text-sm text-gray-500">Card {i+1}/{items.length}</div>
        <div className="flex gap-1 items-center">
          <span className="chip">Mastery: {mastery}/5</span>
        </div>
      </div>
      <div className="card p-6 md:p-10 text-center select-none">
        <div className="text-sm text-gray-400 mb-2">{showBack? "Meaning":"Chinese"}</div>
        <div className={"font-bold "+(showBack?"text-2xl":"text-6xl md:text-7xl")}>
          {showBack
            ? (<div>
                <div className="text-2xl">{card.en}</div>
                <div className="text-gray-500 mt-1">{card.ru}</div>
              </div>)
            : card.zh}
        </div>

        <div className="mt-6 flex flex-wrap justify-center gap-2">
          <button className="btn btn-soft" onClick={prev}>← Prev</button>
          <button className="btn btn-soft" onClick={()=>setShowBack(s=>!s)}>Flip (Space)</button>
          <button className="btn btn-soft" onClick={speakNow}>🔊 Voice (V)</button>
          <button className="btn btn-soft" onClick={again}>Again (A)</button>
          <button className="btn btn-primary" onClick={knew}>Knew (K)</button>
          <button className="btn btn-soft" onClick={next}>Next →</button>
        </div>
      </div>
    </div>
  );
}

/** ---------- Quiz (MCQ) ---------- */
function Quiz({items, updateProgress}) {
  const makeQ = () => {
    const correct = sample(items);
    const wrongs = shuffle(items.filter(w => w.id !== correct.id)).slice(0,3);
    const opts = shuffle([correct, ...wrongs]);
    return { correct, opts };
  };
  const [q, setQ] = React.useState(makeQ());
  const [picked, setPicked] = React.useState(null);

  const choose = (opt) => {
    setPicked(opt.id);
    if (opt.id === q.correct.id) {
      updateProgress(q.correct.id, "+1");
      speak(q.correct.zh, 'zh-CN');
      setTimeout(()=>{ setPicked(null); setQ(makeQ()); }, 600);
    } else {
      updateProgress(q.correct.id, "-1");
    }
  };

  return (
    <div className="max-w-4xl mx-auto p-4">
      <div className="card p-6 md:p-8">
        <div className="text-center text-sm text-gray-500 mb-2">Choose the correct meaning</div>
        <div className="text-center text-5xl md:text-6xl font-bold mb-6">{q.correct.zh}</div>
        <div className="grid md:grid-cols-2 gap-3">
          {q.opts.map(opt=>(
            <button key={opt.id}
              onClick={()=>choose(opt)}
              className={
                "btn btn-soft justify-start text-left " +
                (picked && opt.id===q.correct.id ? "border-green-600" : "") +
                (picked && opt.id===picked && picked!==q.correct.id ? "border-red-400" : "")
              }>
              <div className="font-medium">{opt.en}</div>
              <div className="text-xs text-gray-500">{opt.ru}</div>
            </button>
          ))}
        </div>
      </div>
    </div>
  )
}

/** ---------- Type-It ---------- */
function TypeIt({items, updateProgress}) {
  const [i, setI] = React.useState(0);
  const [val, setVal] = React.useState("");
  const [ok, setOk] = React.useState(null);

  const w = items[i];

  const submit = (e) => {
    e.preventDefault();
    const correct = val.trim() === w.zh;
    setOk(correct);
    if (correct) {
      updateProgress(w.id, "+1");
      speak(w.zh, 'zh-CN');
      setTimeout(()=>{
        setI((i+1)%items.length);
        setVal(""); setOk(null);
      }, 500);
    } else {
      updateProgress(w.id, "-1");
    }
  };

  return (
    <div className="max-w-xl mx-auto p-4">
      <div className="card p-6 md:p-8">
        <div className="text-center text-sm text-gray-500 mb-1">Type the Chinese characters</div>
        <div className="text-center font-semibold">{w.en}</div>
        <div className="text-center text-gray-500 text-sm">{w.ru}</div>
        <form onSubmit={submit} className="mt-5 flex gap-2">
          <input className="flex-1 border rounded-xl px-3 py-2"
                 placeholder="Type here in Chinese…"
                 value={val} onChange={e=>setVal(e.target.value)} />
          <button className="btn btn-primary">Check</button>
        </form>
        {ok===true && <div className="mt-3 text-green-700">✔ 正确！ {w.zh}</div>}
        {ok===false && <div className="mt-3 text-red-600">✘ 再试一次～ 正确答案：{w.zh}</div>}
      </div>
    </div>
  )
}

/** ---------- Mini Drag & Drop ---------- */
function MiniGame({items, updateProgress}) {
  const roundWords = React.useMemo(()=>shuffle(items).slice(0,6), [items]);
  const [targets, setTargets] = React.useState(shuffle(roundWords));
  const [done, setDone] = React.useState({}); // id -> matched?

  const onDragStart = (e, id) => e.dataTransfer.setData("text/id", id);
  const onDrop = (e, targetId) => {
    const dragged = e.dataTransfer.getData("text/id");
    if (!dragged) return;
    if (dragged === targetId) {
      setDone(d => ({...d, [targetId]: true}));
      updateProgress(targetId, "+1");
      const w = roundWords.find(x=>x.id===targetId);
      speak(w.zh, 'zh-CN');
    } else {
      updateProgress(targetId, "-1");
    }
  };

  const complete = Object.values(done).filter(Boolean).length === roundWords.length;

  return (
    <div className="max-w-5xl mx-auto p-4">
      <div className="grid md:grid-cols-2 gap-6">
        <div className="card p-4">
          <div className="text-sm text-gray-500 mb-2">Drag these Chinese words</div>
          <div className="flex flex-wrap gap-2">
            {roundWords.map(w=>(
              <div key={"drag-"+w.id}
                   draggable={!done[w.id]}
                   onDragStart={(e)=>onDragStart(e, w.id)}
                   className={"px-3 py-2 rounded-xl border bg-white cursor-move select-none "+(done[w.id]?"opacity-40 line-through":"")}>
                {w.zh}
              </div>
            ))}
          </div>
        </div>

        <div className="card p-4">
          <div className="text-sm text-gray-500 mb-2">Drop onto the matching meaning</div>
          <div className="grid sm:grid-cols-2 gap-2">
            {targets.map(w=>(
              <div key={"tgt-"+w.id}
                   onDragOver={(e)=>e.preventDefault()}
                   onDrop={(e)=>onDrop(e, w.id)}
                   className={
                     "p-3 rounded-xl border min-h-[56px] bg-white " +
                     (done[w.id] ? "border-green-600" : "border-dashed")
                   }>
                <div className="font-medium">{w.en}</div>
                <div className="text-xs text-gray-500">{w.ru}</div>
              </div>
            ))}
          </div>
          {complete && <div className="mt-3 text-green-700 font-medium">Nice! All matched 🎉</div>}
        </div>
      </div>
    </div>
  )
}

/** ---------- Wordlist (reference) ---------- */
function WordList({items, progress}) {
  const [q, setQ] = React.useState("");
  const filtered = items.filter(w =>
    w.zh.includes(q) || w.en.toLowerCase().includes(q.toLowerCase()) || w.ru.toLowerCase().includes(q.toLowerCase())
  );
  return (
    <div className="max-w-6xl mx-auto p-4">
      <div className="flex items-center justify-between">
        <h3 className="text-lg font-semibold">Wordlist</h3>
        <input className="border rounded-xl px-3 py-1.5 w-60"
               placeholder="Search…" value={q} onChange={e=>setQ(e.target.value)} />
      </div>
      <div className="mt-3 overflow-auto">
        <table className="w-full text-sm">
          <thead>
            <tr className="text-left text-gray-500">
              <th className="py-2 pr-3">#</th>
              <th className="py-2 pr-3">汉字</th>
              <th className="py-2 pr-3">English</th>
              <th className="py-2 pr-3">Русский</th>
              <th className="py-2 pr-3">Mastery</th>
              <th className="py-2 pr-3">Speak</th>
            </tr>
          </thead>
          <tbody>
            {filtered.map((w,idx)=>(
              <tr key={w.id} className="border-t">
                <td className="py-2 pr-3">{idx+1}</td>
                <td className="py-2 pr-3 font-medium">{w.zh}</td>
                <td className="py-2 pr-3">{w.en}</td>
                <td className="py-2 pr-3 text-gray-600">{w.ru}</td>
                <td className="py-2 pr-3">{(progress[w.id]?.m||0)}/5</td>
                <td className="py-2 pr-3">
                  <button className="btn btn-soft" onClick={()=>speak(w.zh,'zh-CN')}>🔊</button>
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  )
}

/** ---------- App ---------- */
function App(){
  const [deck, setDeck] = React.useState("ALL");
  const [mode, setMode] = React.useState("Flashcards");
  const [progress, setProgress] = React.useState(loadProgress());

  const items = React.useMemo(()=>{
    if (deck==="L1") return L1;
    if (deck==="L2") return L2;
    return ALL;
  }, [deck]);

  const updateProgress = (id, value) => {
    setProgress(prev=>{
      const cur = prev[id]?.m ?? 0;
      let m;
      if (typeof value === "string") {
        if (value === "+1") m = Math.min(5, cur+1);
        else if (value === "-1") m = Math.max(0, cur-1);
      } else {
        m = value;
      }
      const next = { ...prev, [id]: { m } };
      saveProgress(next);
      return next;
    });
  };

  const stats = React.useMemo(()=>{
    const total = items.length;
    const mastered = items.filter(w => (progress[w.id]?.m||0) >= 4).length;
    const percent = total ? Math.round(mastered*100/total) : 0;
    return { total, mastered, percent };
  }, [items, progress]);

  const onReset = () => {
    if (confirm("Clear all progress?")) {
      localStorage.removeItem(STORAGE_KEY);
      setProgress({});
    }
  };

  return (
    <div>
      <Header deckName={deck==="ALL"?"L1&L2":" "+deck}
              mode={mode} setMode={setMode}
              stats={stats} onReset={onReset}/>
      <DeckPicker deck={deck} setDeck={setDeck}/>
      {mode==="Flashcards" && <Flashcards items={items} progress={progress} updateProgress={updateProgress}/>}
      {mode==="Quiz" && <Quiz items={items} updateProgress={updateProgress}/>}
      {mode==="Type-It" && <TypeIt items={items} updateProgress={updateProgress}/>}
      {mode==="Mini-Game" && <MiniGame items={items} updateProgress={updateProgress}/>}
      {mode==="List" && <WordList items={items} progress={progress}/>}
      <footer className="max-w-6xl mx-auto px-4 py-8 text-xs text-gray-500">
        <div className="flex flex-wrap gap-2 items-center">
          <span className="chip">Theme: fresh green</span>
          <span className="chip">Responsive</span>
          <span className="chip">LocalStorage progress</span>
          <span className="chip">Hotkeys: Space/K/A/V</span>
        </div>
      </footer>
    </div>
  );
}

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<App/>);
  </script>
</body>
</html>
